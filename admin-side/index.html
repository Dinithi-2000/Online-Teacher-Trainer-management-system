<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - EduMentor Pro</title>
    
    <!-- CSS -->
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/admin-styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Source+Sans+Pro:wght@300;400;600;700&family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.css">
</head>
<body class="admin-body">
    <!-- Admin Header -->
    <header class="admin-header">
        <div class="admin-header-content">
            <div class="admin-brand">
                <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Toggle menu">
                    <i class="fas fa-bars"></i>
                </button>
                <i class="fas fa-shield-alt"></i>
                <span class="brand-text">EduMentor Pro</span>
                <span class="admin-badge">Admin</span>
            </div>
            
            <div class="header-search">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Search anything..." id="globalSearch">
                </div>
            </div>
            
            <div class="header-actions">
                <button class="notification-btn" title="Notifications">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge">3</span>
                </button>
                
                <div class="admin-profile" id="adminProfile">
                    <img src="../assets/images/admin-avatar.jpg" alt="Admin" class="admin-avatar" id="adminAvatar">
                    <div class="admin-details">
                        <span class="admin-name" id="adminName">John Admin</span>
                        <span class="admin-role" id="adminRole">Super Admin</span>
                    </div>
                    <i class="fas fa-chevron-down"></i>
                    
                    <!-- Profile Dropdown -->
                    <div class="profile-dropdown" id="profileDropdown">
                        <div class="dropdown-header">
                            <img src="../assets/images/admin-avatar.jpg" alt="Admin" class="dropdown-avatar">
                            <div class="dropdown-info">
                                <span class="dropdown-name" id="dropdownName">John Admin</span>
                                <span class="dropdown-email" id="dropdownEmail">admin@edumentor.pro</span>
                            </div>
                        </div>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item">
                            <i class="fas fa-user"></i>
                            <span>Profile Settings</span>
                        </a>
                        <a href="#" class="dropdown-item">
                            <i class="fas fa-cog"></i>
                            <span>Account Settings</span>
                        </a>
                        <a href="#" class="dropdown-item">
                            <i class="fas fa-shield-alt"></i>
                            <span>Security</span>
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item logout-item" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Logout</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Admin Layout -->
    <div class="admin-layout">
        <!-- Enhanced Sidebar -->
        <aside class="admin-sidebar">
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <h3>Main</h3>
                    <ul>
                        <li><a href="index.html" class="nav-link active">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>Dashboard</span>
                        </a></li>
                        <li><a href="analytics.html" class="nav-link">
                            <i class="fas fa-chart-line"></i>
                            <span>Analytics</span>
                        </a></li>
                    </ul>
                </div>
                
                <div class="nav-section">
                    <h3>Content Management</h3>
                    <ul>
                        <li><a href="courses.html" class="nav-link">
                            <i class="fas fa-book"></i>
                            <span>Courses</span>
                            <span class="nav-badge">24</span>
                        </a></li>
                        <li><a href="trainers.html" class="nav-link">
                            <i class="fas fa-chalkboard-teacher"></i>
                            <span>Trainers</span>
                            <span class="nav-badge">12</span>
                        </a></li>
                        <li><a href="blog.html" class="nav-link">
                            <i class="fas fa-blog"></i>
                            <span>Blog Posts</span>
                        </a></li>
                        <li><a href="resources.html" class="nav-link">
                            <i class="fas fa-file-alt"></i>
                            <span>Resources</span>
                        </a></li>
                    </ul>
                </div>
                
                <div class="nav-section">
                    <h3>User Management</h3>
                    <ul>
                        <li><a href="users.html" class="nav-link">
                            <i class="fas fa-users"></i>
                            <span>Users</span>
                            <span class="nav-badge">1.2K</span>
                        </a></li>
                        <li><a href="roles.html" class="nav-link">
                            <i class="fas fa-user-shield"></i>
                            <span>Roles & Permissions</span>
                        </a></li>
                        <li><a href="registrations.html" class="nav-link">
                            <i class="fas fa-user-plus"></i>
                            <span>Registrations</span>
                            <span class="nav-badge new">5</span>
                        </a></li>
                    </ul>
                </div>
                
                <div class="nav-section">
                    <h3>Learning Management</h3>
                    <ul>
                        <li><a href="enrollments.html" class="nav-link">
                            <i class="fas fa-graduation-cap"></i>
                            <span>Enrollments</span>
                        </a></li>
                        <li><a href="certifications.html" class="nav-link">
                            <i class="fas fa-certificate"></i>
                            <span>Certifications</span>
                        </a></li>
                        <li><a href="progress.html" class="nav-link">
                            <i class="fas fa-tasks"></i>
                            <span>Progress Tracking</span>
                        </a></li>
                        <li><a href="assessments.html" class="nav-link">
                            <i class="fas fa-clipboard-check"></i>
                            <span>Assessments</span>
                        </a></li>
                    </ul>
                </div>
                
                <div class="nav-section">
                    <h3>Community</h3>
                    <ul>
                        <li><a href="forum.html" class="nav-link">
                            <i class="fas fa-comments"></i>
                            <span>Forum Management</span>
                        </a></li>
                        <li><a href="discussions.html" class="nav-link">
                            <i class="fas fa-comment-dots"></i>
                            <span>Discussions</span>
                        </a></li>
                        <li><a href="moderation.html" class="nav-link">
                            <i class="fas fa-eye"></i>
                            <span>Content Moderation</span>
                        </a></li>
                    </ul>
                </div>
                
                <div class="nav-section">
                    <h3>System</h3>
                    <ul>
                        <li><a href="settings.html" class="nav-link">
                            <i class="fas fa-cogs"></i>
                            <span>Settings</span>
                        </a></li>
                        <li><a href="backups.html" class="nav-link">
                            <i class="fas fa-database"></i>
                            <span>Backups</span>
                        </a></li>
                        <li><a href="logs.html" class="nav-link">
                            <i class="fas fa-file-alt"></i>
                            <span>System Logs</span>
                        </a></li>
                        <li><a href="maintenance.html" class="nav-link">
                            <i class="fas fa-tools"></i>
                            <span>Maintenance</span>
                        </a></li>
                    </ul>
                </div>
            </nav>
            
            <div class="sidebar-footer">
                <a href="../user-side/index.html" class="btn btn-outline btn-sm">
                    <i class="fas fa-external-link-alt"></i> View Site
                </a>
            </div>
        </aside>
        
        <!-- Main Dashboard Content -->
        <main class="admin-main">
            <div class="dashboard-header">
                <div class="header-content">
                    <h1>Dashboard Overview</h1>
                    <p>Welcome back, John! Here's what's happening at EduMentor Pro today.</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-outline">
                        <i class="fas fa-download"></i> Export Report
                    </button>
                    <button class="btn btn-primary">
                        <i class="fas fa-plus"></i> Create New
                    </button>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="stats-overview">
                <div class="stat-card">
                    <div class="stat-icon primary">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-details">
                        <h3>2,847</h3>
                        <p>Total Users</p>
                        <span class="stat-change positive">
                            <i class="fas fa-arrow-up"></i> +12%
                        </span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon success">
                        <i class="fas fa-book"></i>
                    </div>
                    <div class="stat-details">
                        <h3>156</h3>
                        <p>Active Courses</p>
                        <span class="stat-change positive">
                            <i class="fas fa-arrow-up"></i> +8%
                        </span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon warning">
                        <i class="fas fa-chalkboard-teacher"></i>
                    </div>
                    <div class="stat-details">
                        <h3>89</h3>
                        <p>Certified Trainers</p>
                        <span class="stat-change positive">
                            <i class="fas fa-arrow-up"></i> +5%
                        </span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon info">
                        <i class="fas fa-graduation-cap"></i>
                    </div>
                    <div class="stat-details">
                        <h3>4,521</h3>
                        <p>Enrollments</p>
                        <span class="stat-change positive">
                            <i class="fas fa-arrow-up"></i> +23%
                        </span>
                    </div>
                </div>
            </div>

            <!-- Dashboard Content Grid -->
            <div class="dashboard-grid">
                <!-- Revenue Chart -->
                <div class="dashboard-card chart-card">
                    <div class="card-header">
                        <h3>Revenue Analytics</h3>
                        <div class="card-actions">
                            <select class="form-control period-selector" aria-label="Select time period">
                                <option>Last 7 days</option>
                                <option>Last 30 days</option>
                                <option>Last 6 months</option>
                                <option>Last year</option>
                            </select>
                        </div>
                    </div>
                    <div class="card-body">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>

                <!-- Recent Activities -->
                <div class="dashboard-card activity-card">
                    <div class="card-header">
                        <h3>Recent Activities</h3>
                        <a href="analytics.html" class="view-all">View All</a>
                    </div>
                    <div class="card-body">
                        <div class="activity-list">
                            <div class="activity-item">
                                <div class="activity-avatar">
                                    <img src="../assets/images/user-1.jpg" alt="User">
                                </div>
                                <div class="activity-details">
                                    <p><strong>Sarah Johnson</strong> enrolled in "Advanced Teaching Methods"</p>
                                    <span class="activity-time">2 minutes ago</span>
                                </div>
                                <div class="activity-icon success">
                                    <i class="fas fa-graduation-cap"></i>
                                </div>
                            </div>

                            <div class="activity-item">
                                <div class="activity-avatar">
                                    <img src="../assets/images/user-2.jpg" alt="User">
                                </div>
                                <div class="activity-details">
                                    <p><strong>Mike Davis</strong> completed "Classroom Management 101"</p>
                                    <span class="activity-time">15 minutes ago</span>
                                </div>
                                <div class="activity-icon info">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                            </div>

                            <div class="activity-item">
                                <div class="activity-avatar">
                                    <img src="../assets/images/user-3.jpg" alt="User">
                                </div>
                                <div class="activity-details">
                                    <p><strong>Emily Chen</strong> published a new blog post</p>
                                    <span class="activity-time">1 hour ago</span>
                                </div>
                                <div class="activity-icon warning">
                                    <i class="fas fa-blog"></i>
                                </div>
                            </div>

                            <div class="activity-item">
                                <div class="activity-avatar">
                                    <img src="../assets/images/user-4.jpg" alt="User">
                                </div>
                                <div class="activity-details">
                                    <p><strong>Dr. Wilson</strong> joined as a new trainer</p>
                                    <span class="activity-time">3 hours ago</span>
                                </div>
                                <div class="activity-icon primary">
                                    <i class="fas fa-user-plus"></i>
                                </div>
                            </div>

                            <div class="activity-item">
                                <div class="activity-avatar">
                                    <img src="../assets/images/user-5.jpg" alt="User">
                                </div>
                                <div class="activity-details">
                                    <p><strong>Alex Martinez</strong> earned a certificate</p>
                                    <span class="activity-time">2 hours ago</span>
                                </div>
                                <div class="activity-icon accent">
                                    <i class="fas fa-certificate"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Top Courses -->
                <div class="dashboard-card courses-card">
                    <div class="card-header">
                        <h3>Top Performing Courses</h3>
                        <a href="courses.html" class="view-all">Manage Courses</a>
                    </div>
                    <div class="card-body">
                        <div class="course-list">
                            <div class="course-item">
                                <div class="course-thumbnail">
                                    <img src="../assets/images/course-1.jpg" alt="Course">
                                </div>
                                <div class="course-info">
                                    <h4>Advanced Teaching Methods</h4>
                                    <p>485 enrolled • 4.8★ rating</p>
                                    <div class="course-progress">
                                        <div class="progress-bar">
                                            <div class="progress-fill" data-progress="92"></div>
                                        </div>
                                        <span>92% completion</span>
                                    </div>
                                </div>
                            </div>

                            <div class="course-item">
                                <div class="course-thumbnail">
                                    <img src="../assets/images/course-2.jpg" alt="Course">
                                </div>
                                <div class="course-info">
                                    <h4>Classroom Management 101</h4>
                                    <p>367 enrolled • 4.6★ rating</p>
                                    <div class="course-progress">
                                        <div class="progress-bar">
                                            <div class="progress-fill" data-progress="87"></div>
                                        </div>
                                        <span>87% completion</span>
                                    </div>
                                </div>
                            </div>

                            <div class="course-item">
                                <div class="course-thumbnail">
                                    <img src="../assets/images/course-3.jpg" alt="Course">
                                </div>
                                <div class="course-info">
                                    <h4>Digital Learning Tools</h4>
                                    <p>298 enrolled • 4.7★ rating</p>
                                    <div class="course-progress">
                                        <div class="progress-bar">
                                            <div class="progress-fill" data-progress="79"></div>
                                        </div>
                                        <span>79% completion</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="dashboard-card actions-card">
                    <div class="card-header">
                        <h3>Quick Actions</h3>
                    </div>
                    <div class="card-body">
                        <div class="action-grid">
                            <button class="action-btn primary" onclick="window.location.href='courses.html'">
                                <i class="fas fa-plus"></i>
                                <span>Add Course</span>
                            </button>
                            <button class="action-btn success" onclick="window.location.href='trainers.html'">
                                <i class="fas fa-user-plus"></i>
                                <span>Add Trainer</span>
                            </button>
                            <button class="action-btn warning" onclick="window.location.href='blog.html'">
                                <i class="fas fa-blog"></i>
                                <span>Create Post</span>
                            </button>
                            <button class="action-btn info" onclick="window.location.href='resources.html'">
                                <i class="fas fa-upload"></i>
                                <span>Upload Resource</span>
                            </button>
                            <button class="action-btn accent" onclick="window.location.href='analytics.html'">
                                <i class="fas fa-chart-bar"></i>
                                <span>View Analytics</span>
                            </button>
                            <button class="action-btn secondary" onclick="window.location.href='settings.html'">
                                <i class="fas fa-cogs"></i>
                                <span>Settings</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- System Status -->
                <div class="dashboard-card status-card">
                    <div class="card-header">
                        <h3>System Status</h3>
                    </div>
                    <div class="card-body">
                        <div class="status-list">
                            <div class="status-item">
                                <div class="status-indicator success"></div>
                                <div class="status-details">
                                    <span class="status-label">Database</span>
                                    <span class="status-value">Healthy</span>
                                </div>
                            </div>
                            <div class="status-item">
                                <div class="status-indicator success"></div>
                                <div class="status-details">
                                    <span class="status-label">API Services</span>
                                    <span class="status-value">Online</span>
                                </div>
                            </div>
                            <div class="status-item">
                                <div class="status-indicator warning"></div>
                                <div class="status-details">
                                    <span class="status-label">Backup System</span>
                                    <span class="status-value">Scheduled</span>
                                </div>
                            </div>
                            <div class="status-item">
                                <div class="status-indicator success"></div>
                                <div class="status-details">
                                    <span class="status-label">Server Uptime</span>
                                    <span class="status-value">99.9%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Enrollments -->
                <div class="dashboard-card enrollments-card">
                    <div class="card-header">
                        <h3>Recent Enrollments</h3>
                        <a href="enrollments.html" class="view-all">View All</a>
                    </div>
                    <div class="card-body">
                        <div class="enrollment-list">
                            <div class="enrollment-item">
                                <div class="student-avatar">
                                    <img src="../assets/images/student-1.jpg" alt="Student">
                                </div>
                                <div class="enrollment-info">
                                    <h4>Lisa Anderson</h4>
                                    <p>JavaScript Fundamentals</p>
                                    <span class="enrollment-time">5 minutes ago</span>
                                </div>
                                <div class="enrollment-status">
                                    <span class="status-badge active">Active</span>
                                </div>
                            </div>

                            <div class="enrollment-item">
                                <div class="student-avatar">
                                    <img src="../assets/images/student-2.jpg" alt="Student">
                                </div>
                                <div class="enrollment-info">
                                    <h4>Robert Kim</h4>
                                    <p>React Development</p>
                                    <span class="enrollment-time">12 minutes ago</span>
                                </div>
                                <div class="enrollment-status">
                                    <span class="status-badge active">Active</span>
                                </div>
                            </div>

                            <div class="enrollment-item">
                                <div class="student-avatar">
                                    <img src="../assets/images/student-3.jpg" alt="Student">
                                </div>
                                <div class="enrollment-info">
                                    <h4>Maria Garcia</h4>
                                    <p>UI/UX Design Basics</p>
                                    <span class="enrollment-time">25 minutes ago</span>
                                </div>
                                <div class="enrollment-status">
                                    <span class="status-badge active">Active</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- JavaScript -->
    <script src="../assets/js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardData();
            loadRecentEnrollments();
            loadPendingApprovals();
        });

        async function loadDashboardData() {
            try {
                const response = await EduMentor.Utils.ajax('admin/stats');
                
                if (response.success) {
                    updateStatsCards(response.data);
                }
            } catch (error) {
                console.error('Failed to load dashboard data:', error);
                EduMentor.Utils.showAlert('Failed to load dashboard statistics', 'warning');
            }
        }

        function updateStatsCards(data) {
            // Update stat cards with real data
            const statElements = document.querySelectorAll('[data-stat]');
            
            statElements.forEach(element => {
                const statKey = element.getAttribute('data-stat');
                if (data[statKey] !== undefined) {
                    element.textContent = data[statKey].toLocaleString();
                }
            });
        }

        async function loadRecentEnrollments() {
            try {
                const response = await EduMentor.Utils.ajax('admin/recent-enrollments');
                
                if (response.success) {
                    displayRecentEnrollments(response.data);
                }
            } catch (error) {
                console.error('Failed to load recent enrollments:', error);
                document.getElementById('recent-enrollments').innerHTML = 
                    '<p class="text-secondary">Failed to load recent enrollments</p>';
            }
        }

        function displayRecentEnrollments(enrollments) {
            const container = document.getElementById('recent-enrollments');
            
            if (enrollments.length === 0) {
                container.innerHTML = '<p class="text-secondary">No recent enrollments</p>';
                return;
            }

            const html = enrollments.map(enrollment => `
                <div class="enrollment-item">
                    <div class="d-flex justify-between align-center">
                        <div>
                            <strong>${enrollment.student_name}</strong>
                            <p class="text-secondary mb-0">${enrollment.course_title}</p>
                        </div>
                        <div class="text-right">
                            <small class="text-secondary">${EduMentor.Utils.formatDate(enrollment.enrollment_date)}</small>
                            <div class="badge badge-success">Enrolled</div>
                        </div>
                    </div>
                </div>
            `).join('');

            container.innerHTML = html;
        }

        async function loadPendingApprovals() {
            try {
                const response = await EduMentor.Utils.ajax('admin/pending-approvals');
                
                if (response.success) {
                    updatePendingCounts(response.data);
                }
            } catch (error) {
                console.error('Failed to load pending approvals:', error);
            }
        }

        function updatePendingCounts(data) {
            document.getElementById('pending-trainers').textContent = data.pending_trainers || 0;
            document.getElementById('pending-courses').textContent = data.pending_courses || 0;
            document.getElementById('pending-resources').textContent = data.pending_resources || 0;
        }

        // Auto-refresh dashboard data every 5 minutes
        setInterval(loadDashboardData, 300000);
    </script>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="../assets/js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize dashboard
            initializeDashboard();
        });

        function initializeDashboard() {
            initializeCharts();
            setupAdminDashboard();
            setupAdminNavigation();
            loadDashboardData();
        }

        function initializeCharts() {
            // Revenue Chart
            const ctx = document.getElementById('revenueChart');
            if (ctx) {
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [{
                            label: 'Revenue ($)',
                            data: [12000, 15000, 18000, 22000, 25000, 28000],
                            borderColor: '#1e3a8a',
                            backgroundColor: 'rgba(30, 58, 138, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }, {
                            label: 'Enrollments',
                            data: [150, 200, 250, 300, 350, 400],
                            borderColor: '#f97316',
                            backgroundColor: 'rgba(249, 115, 22, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            yAxisID: 'y1'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            mode: 'index',
                            intersect: false,
                        },
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                ticks: {
                                    callback: function(value) {
                                        return '$' + value.toLocaleString();
                                    }
                                }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                grid: {
                                    drawOnChartArea: false,
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.datasetIndex === 0) {
                                            label += '$' + context.parsed.y.toLocaleString();
                                        } else {
                                            label += context.parsed.y.toLocaleString();
                                        }
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }

        function setupAdminDashboard() {
            // Animate stats on load
            animateStats();
            
            // Setup quick actions
            setupQuickActions();
            
            // Setup real-time updates
            setupRealTimeUpdates();
            
            // Setup progress bars
            initializeProgressBars();
        }

        function animateStats() {
            const statNumbers = document.querySelectorAll('.stat-details h3');
            statNumbers.forEach(stat => {
                const finalValue = parseInt(stat.textContent.replace(/,/g, ''));
                let currentValue = 0;
                const increment = finalValue / 50;
                
                const timer = setInterval(() => {
                    currentValue += increment;
                    if (currentValue >= finalValue) {
                        stat.textContent = finalValue.toLocaleString();
                        clearInterval(timer);
                    } else {
                        stat.textContent = Math.floor(currentValue).toLocaleString();
                    }
                }, 20);
            });
        }

        function initializeProgressBars() {
            setTimeout(() => {
                const progressBars = document.querySelectorAll('.progress-fill');
                progressBars.forEach(bar => {
                    const percentage = bar.getAttribute('data-progress') || '0';
                    bar.style.width = percentage + '%';
                });
            }, 500);
        }

        function setupQuickActions() {
            const actionButtons = document.querySelectorAll('.action-btn');
            actionButtons.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    const action = this.querySelector('span').textContent;
                    handleQuickAction(action);
                });
            });
        }

        function handleQuickAction(action) {
            switch(action) {
                case 'Add Course':
                    window.location.href = 'courses.html?action=create';
                    break;
                case 'Invite Trainer':
                    window.location.href = 'trainers.html?action=invite';
                    break;
                case 'View Reports':
                    window.location.href = 'analytics.html';
                    break;
                case 'Manage Users':
                    window.location.href = 'users.html';
                    break;
                case 'System Monitor':
                    window.location.href = 'settings.html';
                    break;
                case 'All Enrollments':
                    window.location.href = 'enrollments.html';
                    break;
                default:
                    console.log('Action not implemented:', action);
            }
        }

        function setupRealTimeUpdates() {
            // Update dashboard data every 30 seconds
            setInterval(() => {
                updateActivityFeed();
                updateSystemStatus();
            }, 30000);
        }

        function updateActivityFeed() {
            // This would normally fetch fresh activity data from API
            console.log('Updating activity feed...');
        }

        function updateSystemStatus() {
            // Update system status indicators
            const statusItems = document.querySelectorAll('.status-indicator');
            statusItems.forEach(indicator => {
                // Simulate status checks (90% uptime)
                const isHealthy = Math.random() > 0.1;
                indicator.className = `status-indicator ${isHealthy ? 'success' : 'warning'}`;
            });
        }

        function setupAdminNavigation() {
            // Mobile menu toggle
            const mobileMenuToggle = document.getElementById('mobileMenuToggle');
            const sidebar = document.querySelector('.admin-sidebar');
            
            if (mobileMenuToggle && sidebar) {
                mobileMenuToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('open');
                });
                
                // Close sidebar when clicking outside on mobile
                document.addEventListener('click', function(e) {
                    if (window.innerWidth <= 768 && 
                        !sidebar.contains(e.target) && 
                        !mobileMenuToggle.contains(e.target)) {
                        sidebar.classList.remove('open');
                    }
                });
            }
            
            // Sidebar navigation
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    navLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Close mobile menu when navigating
                    if (window.innerWidth <= 768) {
                        sidebar.classList.remove('open');
                    }
                });
            });

            // Global search functionality
            const searchInput = document.getElementById('globalSearch');
            if (searchInput) {
                let searchTimeout;
                searchInput.addEventListener('input', function() {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        if (this.value.length >= 2) {
                            performGlobalSearch(this.value);
                        }
                    }, 300);
                });
            }
        }

        function performGlobalSearch(query) {
            // This would normally search across all admin content
            console.log(`Searching for: ${query}`);
            // In a real implementation, this would show search results dropdown
        }

        // Export functions for use in other admin pages
        window.AdminDashboard = {
            initializeDashboard,
            initializeCharts,
            setupAdminDashboard,
            setupAdminNavigation,
            performGlobalSearch
        };
    </script>
    
    <!-- Admin Authentication JavaScript -->
    <script>
        // Admin Authentication Manager
        class AdminAuthManager {
            constructor() {
                this.init();
            }
            
            init() {
                this.checkAuthentication();
                this.setupProfileDropdown();
                this.setupLogout();
            }
            
            async checkAuthentication() {
                try {
                    // First check for fallback session (development mode)
                    const fallbackAuth = sessionStorage.getItem('admin_logged_in');
                    if (fallbackAuth === 'true') {
                        const username = sessionStorage.getItem('admin_username') || 'Admin';
                        const loginTime = sessionStorage.getItem('admin_login_time');
                        
                        // Check if session is still valid (24 hours)
                        if (loginTime) {
                            const loginDate = new Date(loginTime);
                            const now = new Date();
                            const hoursDiff = (now - loginDate) / (1000 * 60 * 60);
                            
                            if (hoursDiff < 24) {
                                // Valid fallback session
                                const mockUser = {
                                    name: username,
                                    email: username.includes('@') ? username : `${username}@edumentor.com`,
                                    role: 'Administrator',
                                    avatar: '../assets/images/admin-avatar.jpg'
                                };
                                this.updateUserInterface(mockUser);
                                return;
                            } else {
                                // Session expired, clear it
                                sessionStorage.removeItem('admin_logged_in');
                                sessionStorage.removeItem('admin_username');
                                sessionStorage.removeItem('admin_login_time');
                            }
                        }
                    }

                    // Try backend authentication
                    const response = await fetch('../backend/api/auth.php?action=check-session');
                    const result = await response.json();
                    
                    if (result.success && result.data.user) {
                        this.updateUserInterface(result.data.user);
                    } else {
                        // Redirect to login if not authenticated
                        window.location.href = 'login-modern.html';
                    }
                } catch (error) {
                    console.error('Authentication check failed:', error);
                    
                    // Check fallback session again as last resort
                    const fallbackAuth = sessionStorage.getItem('admin_logged_in');
                    if (fallbackAuth === 'true') {
                        const username = sessionStorage.getItem('admin_username') || 'Admin';
                        const mockUser = {
                            name: username,
                            email: username.includes('@') ? username : `${username}@edumentor.com`,
                            role: 'Administrator (Development)',
                            avatar: '../assets/images/admin-avatar.jpg'
                        };
                        this.updateUserInterface(mockUser);
                    } else {
                        // Redirect to login on error
                        window.location.href = 'login-modern.html';
                    }
                }
            }
            
            updateUserInterface(user) {
                // Update admin name and role
                const adminName = document.getElementById('adminName');
                const adminRole = document.getElementById('adminRole');
                const dropdownName = document.getElementById('dropdownName');
                const dropdownEmail = document.getElementById('dropdownEmail');
                
                if (adminName) adminName.textContent = user.name;
                if (adminRole) adminRole.textContent = user.role.charAt(0).toUpperCase() + user.role.slice(1);
                if (dropdownName) dropdownName.textContent = user.name;
                if (dropdownEmail) dropdownEmail.textContent = user.email;
                
                // Update avatar with initials if no image
                const initials = user.name.split(' ').map(n => n[0]).join('').toUpperCase();
                const avatars = document.querySelectorAll('.admin-avatar');
                avatars.forEach(avatar => {
                    if (!avatar.querySelector('img[src]')) {
                        avatar.setAttribute('data-initials', initials);
                        avatar.style.setProperty('--initials', `"${initials}"`);
                    }
                });
            }
            
            setupProfileDropdown() {
                const adminProfile = document.getElementById('adminProfile');
                const profileDropdown = document.getElementById('profileDropdown');
                
                if (!adminProfile || !profileDropdown) return;
                
                adminProfile.addEventListener('click', (e) => {
                    e.stopPropagation();
                    profileDropdown.classList.toggle('active');
                });
                
                // Close dropdown when clicking outside
                document.addEventListener('click', (e) => {
                    if (!adminProfile.contains(e.target)) {
                        profileDropdown.classList.remove('active');
                    }
                });
                
                // Prevent dropdown from closing when clicking inside
                profileDropdown.addEventListener('click', (e) => {
                    e.stopPropagation();
                });
            }
            
            setupLogout() {
                const logoutBtn = document.getElementById('logoutBtn');
                if (!logoutBtn) return;
                
                logoutBtn.addEventListener('click', async (e) => {
                    e.preventDefault();
                    
                    try {
                        // Always clear fallback session data
                        sessionStorage.removeItem('admin_logged_in');
                        sessionStorage.removeItem('admin_username');
                        sessionStorage.removeItem('admin_login_time');
                        
                        const formData = new FormData();
                        formData.append('action', 'logout');
                        
                        const response = await fetch('../backend/api/auth.php', {
                            method: 'POST',
                            body: formData
                        });
                        
                        const result = await response.json();
                        
                        if (result.success) {
                            // Show success message briefly
                            this.showAlert('Logged out successfully!', 'success');
                            
                            // Redirect to login page after a short delay
                            setTimeout(() => {
                                window.location.href = 'login-modern.html';
                            }, 1000);
                        } else {
                            this.showAlert('Logout failed. Please try again.', 'error');
                        }
                    } catch (error) {
                        console.error('Logout error:', error);
                        // Even if backend logout fails, clear local session and redirect
                        this.showAlert('Logged out successfully!', 'success');
                        setTimeout(() => {
                            window.location.href = 'login-modern.html';
                        }, 1000);
                    }
                });
            }
            
            showAlert(message, type) {
                // Create alert container if it doesn't exist
                let alertContainer = document.getElementById('alertContainer');
                if (!alertContainer) {
                    alertContainer = document.createElement('div');
                    alertContainer.id = 'alertContainer';
                    alertContainer.className = 'alert-container';
                    document.body.appendChild(alertContainer);
                }
                
                const alert = document.createElement('div');
                alert.className = `alert alert-${type}`;
                alert.innerHTML = `
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                    <span>${message}</span>
                    <button type="button" class="alert-close" onclick="this.parentElement.remove()">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                alertContainer.appendChild(alert);
                
                // Auto remove after 5 seconds
                setTimeout(() => {
                    if (alert.parentElement) {
                        alert.remove();
                    }
                }, 5000);
            }
        }
        
        // Initialize authentication when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            new AdminAuthManager();
        });
    </script>
</body>
</html>
