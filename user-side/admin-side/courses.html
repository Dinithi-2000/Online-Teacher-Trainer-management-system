<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Management - EduMentor Pro Admin</title>
    
    <!-- CSS -->
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/admin-styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Source+Sans+Pro:wght@300;400;600;700&family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet">
</head>
<body class="admin-body">
    <!-- Admin Header -->
    <header class="admin-header">
        <div class="admin-header-content">
            <div class="admin-brand">
                <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Toggle menu">
                    <i class="fas fa-bars"></i>
                </button>
                <i class="fas fa-shield-alt"></i>
                <span class="brand-text">EduMentor Pro</span>
                <span class="admin-badge">Admin</span>
            </div>
            
            <div class="header-search">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Search courses..." id="courseSearch">
                </div>
            </div>
            
            <div class="header-actions">
                <button class="notification-btn" title="Notifications">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge">3</span>
                </button>
                
                <div class="admin-profile">
                    <img src="../assets/images/admin-avatar.jpg" alt="Admin" class="admin-avatar">
                    <div class="admin-details">
                        <span class="admin-name">John Admin</span>
                        <span class="admin-role">Super Admin</span>
                    </div>
                    <i class="fas fa-chevron-down"></i>
                </div>
            </div>
        </div>
    </header>

    <!-- Admin Layout -->
    <div class="admin-layout">
        <!-- Sidebar -->
        <aside class="admin-sidebar">
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <h3>Main</h3>
                    <ul>
                        <li><a href="index.html" class="nav-link">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>Dashboard</span>
                        </a></li>
                        <li><a href="analytics.html" class="nav-link">
                            <i class="fas fa-chart-line"></i>
                            <span>Analytics</span>
                        </a></li>
                    </ul>
                </div>
                
                <div class="nav-section">
                    <h3>Content Management</h3>
                    <ul>
                        <li><a href="courses.html" class="nav-link active">
                            <i class="fas fa-book"></i>
                            <span>Courses</span>
                            <span class="nav-badge">24</span>
                        </a></li>
                        <li><a href="trainers.html" class="nav-link">
                            <i class="fas fa-chalkboard-teacher"></i>
                            <span>Trainers</span>
                        </a></li>
                        <li><a href="blog.html" class="nav-link">
                            <i class="fas fa-blog"></i>
                            <span>Blog Posts</span>
                        </a></li>
                        <li><a href="resources.html" class="nav-link">
                            <i class="fas fa-file-alt"></i>
                            <span>Resources</span>
                        </a></li>
                    </ul>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="admin-main">
            <div class="dashboard-header">
                <div class="header-content">
                    <h1>Course Management</h1>
                    <p>Manage all courses, lessons, and educational content</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-primary" id="addCourseBtn">
                        <i class="fas fa-plus"></i> Add New Course
                    </button>
                    <button class="btn btn-outline">
                        <i class="fas fa-download"></i> Export Data
                    </button>
                </div>
            </div>

            <!-- Course Statistics -->
            <div class="stats-grid" style="grid-template-columns: repeat(4, 1fr); margin-bottom: 2rem;">
                <div class="stat-card primary">
                    <div class="stat-content">
                        <div class="stat-icon">
                            <i class="fas fa-book"></i>
                        </div>
                        <div class="stat-details">
                            <h3>156</h3>
                            <p>Total Courses</p>
                        </div>
                    </div>
                </div>
                <div class="stat-card success">
                    <div class="stat-content">
                        <div class="stat-icon">
                            <i class="fas fa-eye"></i>
                        </div>
                        <div class="stat-details">
                            <h3>142</h3>
                            <p>Published</p>
                        </div>
                    </div>
                </div>
                <div class="stat-card warning">
                    <div class="stat-content">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-details">
                            <h3>14</h3>
                            <p>Pending Review</p>
                        </div>
                    </div>
                </div>
                <div class="stat-card info">
                    <div class="stat-content">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-details">
                            <h3>4,521</h3>
                            <p>Total Enrollments</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Course Management Interface -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h3>All Courses</h3>
                    <div class="course-filters">
                        <select class="form-control" id="statusFilter" title="Filter by status">
                            <option value="">All Status</option>
                            <option value="published">Published</option>
                            <option value="draft">Draft</option>
                            <option value="pending">Pending Review</option>
                        </select>
                        <select class="form-control" id="categoryFilter" title="Filter by category">
                            <option value="">All Categories</option>
                            <option value="classroom-management">Classroom Management</option>
                            <option value="curriculum">Curriculum Design</option>
                            <option value="technology">Educational Technology</option>
                            <option value="assessment">Assessment Methods</option>
                        </select>
                    </div>
                </div>
                <div class="card-body">
                    <div class="course-table-container">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>Course</th>
                                    <th>Category</th>
                                    <th>Instructor</th>
                                    <th>Enrollments</th>
                                    <th>Status</th>
                                    <th>Last Updated</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="courseTableBody">
                                <tr>
                                    <td>
                                        <div class="course-info">
                                            <img src="../assets/images/course-1.jpg" alt="Course" class="course-thumbnail">
                                            <div>
                                                <h4>Advanced Teaching Methods</h4>
                                                <p>Comprehensive guide to modern teaching</p>
                                            </div>
                                        </div>
                                    </td>
                                    <td><span class="category-tag classroom">Classroom Management</span></td>
                                    <td>Dr. Sarah Wilson</td>
                                    <td>485</td>
                                    <td><span class="status-badge published">Published</span></td>
                                    <td>2 hours ago</td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="btn-icon" title="Edit">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn-icon" title="View">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="btn-icon" title="Duplicate">
                                                <i class="fas fa-copy"></i>
                                            </button>
                                            <button class="btn-icon danger" title="Delete">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <div class="course-info">
                                            <img src="../assets/images/course-2.jpg" alt="Course" class="course-thumbnail">
                                            <div>
                                                <h4>Digital Learning Tools</h4>
                                                <p>Master modern educational technology</p>
                                            </div>
                                        </div>
                                    </td>
                                    <td><span class="category-tag technology">Technology</span></td>
                                    <td>Prof. Mike Johnson</td>
                                    <td>367</td>
                                    <td><span class="status-badge published">Published</span></td>
                                    <td>1 day ago</td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="btn-icon" title="Edit">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn-icon" title="View">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="btn-icon" title="Duplicate">
                                                <i class="fas fa-copy"></i>
                                            </button>
                                            <button class="btn-icon danger" title="Delete">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <div class="course-info">
                                            <img src="../assets/images/course-3.jpg" alt="Course" class="course-thumbnail">
                                            <div>
                                                <h4>Assessment Strategies</h4>
                                                <p>Effective student evaluation methods</p>
                                            </div>
                                        </div>
                                    </td>
                                    <td><span class="category-tag assessment">Assessment</span></td>
                                    <td>Dr. Emily Chen</td>
                                    <td>298</td>
                                    <td><span class="status-badge pending">Pending Review</span></td>
                                    <td>3 days ago</td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="btn-icon" title="Edit">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn-icon" title="View">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="btn-icon success" title="Approve">
                                                <i class="fas fa-check"></i>
                                            </button>
                                            <button class="btn-icon danger" title="Reject">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Pagination -->
                    <div class="pagination-container">
                        <div class="pagination-info">
                            Showing 1-3 of 156 courses
                        </div>
                        <div class="pagination">
                            <button class="pagination-btn" disabled>
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="pagination-btn active">1</button>
                            <button class="pagination-btn">2</button>
                            <button class="pagination-btn">3</button>
                            <button class="pagination-btn">...</button>
                            <button class="pagination-btn">52</button>
                            <button class="pagination-btn">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add Course Modal -->
    <div class="modal" id="addCourseModal" aria-hidden="true">
        <div class="modal-content large">
            <div class="modal-header">
                <h3>Add New Course</h3>
                <button type="button" class="modal-close" aria-label="Close modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form class="modal-body" id="addCourseForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="courseTitle" class="form-label">Course Title *</label>
                        <input type="text" id="courseTitle" name="title" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="courseCategory" class="form-label">Category *</label>
                        <select id="courseCategory" name="category" class="form-control" required>
                            <option value="">Select Category</option>
                            <option value="Digital Teaching">Digital Teaching</option>
                            <option value="Leadership">Leadership</option>
                            <option value="Assessment">Assessment</option>
                            <option value="Classroom Management">Classroom Management</option>
                            <option value="Curriculum Design">Curriculum Design</option>
                            <option value="Educational Technology">Educational Technology</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="courseLevel" class="form-label">Level *</label>
                        <select id="courseLevel" name="level" class="form-control" required>
                            <option value="">Select Level</option>
                            <option value="beginner">Beginner</option>
                            <option value="intermediate">Intermediate</option>
                            <option value="advanced">Advanced</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="courseDuration" class="form-label">Duration (hours) *</label>
                        <input type="number" id="courseDuration" name="duration" class="form-control" min="1" max="200" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="courseInstructor" class="form-label">Instructor *</label>
                        <select id="courseInstructor" name="instructor" class="form-control" required>
                            <option value="">Select Instructor</option>
                            <option value="1">Dr. Sarah Wilson</option>
                            <option value="2">Prof. Mike Johnson</option>
                            <option value="3">Dr. Emily Chen</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="coursePrice" class="form-label">Price ($)</label>
                        <input type="number" id="coursePrice" name="price" class="form-control" min="0" step="0.01">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="courseDescription" class="form-label">Description *</label>
                    <textarea id="courseDescription" name="description" class="form-control" rows="4" required></textarea>
                </div>
                
                <div class="form-group">
                    <label for="courseThumbnail" class="form-label">Course Thumbnail</label>
                    <input type="file" id="courseThumbnail" name="thumbnail" class="form-control" accept="image/*">
                </div>
            </form>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" data-dismiss="modal">Cancel</button>
                <button type="submit" form="addCourseForm" class="btn btn-primary">Create Course</button>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="../assets/js/main.js"></script>
    <script>
        // Courses CRUD Management System
        let courses = [];
        let editingCourseId = null;

        document.addEventListener('DOMContentLoaded', function() {
            initializeCoursesData();
            loadCourses();
            setupCourseManagement();
        });

        function initializeCoursesData() {
            // Initialize with sample data if localStorage is empty
            if (!localStorage.getItem('edumentor_admin_courses')) {
                const sampleCourses = [
                    {
                        id: Date.now() - 3600000,
                        title: "Modern Teaching Methodologies",
                        category: "Education",
                        instructor: "Dr. Sarah Johnson",
                        price: 299.99,
                        description: "Learn innovative teaching approaches for the digital age",
                        status: "Published",
                        enrollments: 45,
                        level: "Intermediate",
                        duration: "8 weeks",
                        rating: 4.8,
                        createdAt: new Date(Date.now() - 3600000).toISOString(),
                        lastModified: new Date().toISOString()
                    },
                    {
                        id: Date.now() - 7200000,
                        title: "Classroom Management Strategies",
                        category: "Management",
                        instructor: "Prof. Michael Brown",
                        price: 199.99,
                        description: "Effective strategies for maintaining productive learning environments",
                        status: "Draft",
                        enrollments: 0,
                        level: "Beginner",
                        duration: "6 weeks",
                        rating: 0,
                        createdAt: new Date(Date.now() - 7200000).toISOString(),
                        lastModified: new Date().toISOString()
                    },
                    {
                        id: Date.now() - 10800000,
                        title: "Digital Learning Tools",
                        category: "Technology",
                        instructor: "Dr. Lisa Chen",
                        price: 399.99,
                        description: "Master the latest educational technology tools and platforms",
                        status: "Published",
                        enrollments: 78,
                        level: "Advanced",
                        duration: "10 weeks",
                        rating: 4.9,
                        createdAt: new Date(Date.now() - 10800000).toISOString(),
                        lastModified: new Date().toISOString()
                    }
                ];
                localStorage.setItem('edumentor_admin_courses', JSON.stringify(sampleCourses));
            }
        }

        async function loadCourses() {
            await loadCoursesFromDatabase();
        }

        async function loadCoursesFromDatabase() {
            try {
                const response = await fetch('../backend/api/courses.php', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    courses = result.data || [];
                    console.log('Loaded courses from database:', courses);
                    displayCourses(courses);
                } else {
                    console.error('Error loading courses:', result.message);
                    showAlert('Error loading courses: ' + result.message, 'error');
                    courses = [];
                    displayCourses(courses);
                }
            } catch (error) {
                console.error('Error loading courses:', error);
                showAlert('Error loading courses: ' + error.message, 'error');
                courses = [];
                displayCourses(courses);
            }
        }

        function displayCourses(coursesToDisplay) {
            const tbody = document.getElementById('courseTableBody');
            tbody.innerHTML = '';

            if (coursesToDisplay.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="text-center">No courses found</td></tr>';
                return;
            }

            coursesToDisplay.forEach(course => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div class="course-info">
                            <img src="${course.image || '../assets/images/course-default.jpg'}" alt="Course" class="course-thumbnail">
                            <div>
                                <h4>${course.title}</h4>
                                <p>${course.short_description || course.description || ''}</p>
                            </div>
                        </div>
                    </td>
                    <td><span class="category-tag ${(course.category || '').toLowerCase()}">${course.category || 'General'}</span></td>
                    <td>${course.trainer_name || 'Not Assigned'}</td>
                    <td>0</td>
                    <td><span class="status-badge ${(course.status || 'active').toLowerCase()}">${course.status || 'Active'}</span></td>
                    <td>${formatDate(course.created_at || new Date())}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-icon" title="Edit" onclick="editCourse(${course.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-icon" title="View" onclick="viewCourse(${course.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-icon ${course.status === 'active' ? 'success' : 'warning'}" 
                                    title="${course.status === 'active' ? 'Unpublish' : 'Publish'}" 
                                    onclick="toggleCourseStatus(${course.id}, '${course.status}')">
                                <i class="fas fa-${course.status === 'active' ? 'eye-slash' : 'eye'}"></i>
                            </button>
                            <button class="btn-icon" title="Duplicate" onclick="duplicateCourse(${course.id})">
                                <i class="fas fa-copy"></i>
                            </button>
                            <button class="btn-icon danger" title="Delete" onclick="deleteCourse(${course.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function setupCourseManagement() {
            // Add course button
            document.getElementById('addCourseBtn').addEventListener('click', function() {
                resetForm();
                editingCourseId = null;
                document.querySelector('#addCourseModal h3').textContent = 'Add New Course';
                document.querySelector('button[type="submit"]').textContent = 'Create Course';
                document.getElementById('addCourseModal').classList.add('active');
                document.getElementById('addCourseModal').setAttribute('aria-hidden', 'false');
            });

            // Close modal
            document.querySelector('.modal-close').addEventListener('click', function() {
                closeModal();
            });

            // Modal background click
            document.getElementById('addCourseModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });

            // Search functionality
            document.getElementById('courseSearch').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const filteredCourses = courses.filter(course => 
                    course.title.toLowerCase().includes(searchTerm) ||
                    course.instructor.toLowerCase().includes(searchTerm) ||
                    course.category.toLowerCase().includes(searchTerm)
                );
                displayCourses(filteredCourses);
            });

            // Filter functionality
            setupFilters();
            
            // Form submission
            setupFormSubmission();
        }

        function setupFilters() {
            const statusFilter = document.getElementById('statusFilter');
            const categoryFilter = document.getElementById('categoryFilter');
            
            [statusFilter, categoryFilter].forEach(filter => {
                if (filter) {
                    filter.addEventListener('change', function() {
                        filterCourses();
                    });
                }
            });
        }

        function filterCourses() {
            const statusFilter = document.getElementById('statusFilter');
            const categoryFilter = document.getElementById('categoryFilter');
            
            let filteredCourses = [...courses];
            
            if (statusFilter && statusFilter.value) {
                filteredCourses = filteredCourses.filter(course => 
                    course.status.toLowerCase() === statusFilter.value.toLowerCase()
                );
            }
            
            if (categoryFilter && categoryFilter.value) {
                filteredCourses = filteredCourses.filter(course => 
                    course.category.toLowerCase() === categoryFilter.value.toLowerCase()
                );
            }
            
            displayCourses(filteredCourses);
        }

        function setupFormSubmission() {
            document.getElementById('addCourseForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const courseData = {
                    title: formData.get('title'),
                    category: formData.get('category'),
                    instructor: formData.get('instructor'),
                    price: parseFloat(formData.get('price')) || 0,
                    description: formData.get('description'),
                    level: formData.get('level') || 'Beginner',
                    duration: formData.get('duration') || '4 weeks'
                };
                
                if (editingCourseId) {
                    updateCourse(editingCourseId, courseData);
                } else {
                    createCourse(courseData);
                }
            });
        }

        // CRUD Operations
        async function createCourse(courseData) {
            try {
                const response = await fetch('../backend/api/courses.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        title: courseData.title,
                        description: courseData.description,
                        short_description: courseData.description.substring(0, 200) + '...',
                        category: courseData.category,
                        level: courseData.level || 'beginner',
                        duration: parseInt(courseData.duration) || 0,
                        price: parseFloat(courseData.price) || 0,
                        instructor_id: null, // Will be set based on logged in user
                        status: 'active'
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    await loadCoursesFromDatabase();
                    closeModal();
                    showAlert('Course created successfully!', 'success');
                } else {
                    showAlert('Error creating course: ' + result.message, 'error');
                }
            } catch (error) {
                console.error('Error creating course:', error);
                showAlert('Error creating course: ' + error.message, 'error');
            }
        }

        async function editCourse(id) {
            try {
                // Fetch course data from database
                const response = await fetch(`../backend/api/courses.php?id=${id}`);
                const result = await response.json();
                
                if (!result.success) {
                    showAlert('Error loading course details: ' + result.message, 'error');
                    return;
                }
                
                const course = result.data;
                editingCourseId = id;
                
                // Populate form with database fields
                document.getElementById('courseTitle').value = course.title || '';
                document.getElementById('courseCategory').value = course.category || '';
                document.getElementById('courseInstructor').value = course.trainer_name || '';
                document.getElementById('coursePrice').value = course.price || '';
                document.getElementById('courseDescription').value = course.description || '';
                document.getElementById('courseLevel').value = course.level || '';
                document.getElementById('courseDuration').value = course.duration || '';
                
                // Update modal title
                document.querySelector('#addCourseModal h3').textContent = 'Edit Course';
                document.querySelector('button[type="submit"]').textContent = 'Update Course';
                
                // Show modal
                document.getElementById('addCourseModal').classList.add('active');
                document.getElementById('addCourseModal').setAttribute('aria-hidden', 'false');
                
            } catch (error) {
                console.error('Error editing course:', error);
                showAlert('Error loading course details', 'error');
            }
        }

        async function updateCourse(id, courseData) {
            try {
                // Prepare data for API (map form fields to database fields)
                const updateData = {
                    title: courseData.title,
                    description: courseData.description,
                    category: courseData.category,
                    level: courseData.level,
                    duration: courseData.duration,
                    price: parseFloat(courseData.price) || 0,
                    status: 'active' // Set status to active when updating
                };

                const response = await fetch(`../backend/api/courses.php?id=${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(updateData)
                });

                const result = await response.json();
                
                if (result.success) {
                    await loadCoursesFromDatabase();
                    closeModal();
                    showAlert('Course updated successfully!', 'success');
                } else {
                    showAlert('Error updating course: ' + result.message, 'error');
                }
                
            } catch (error) {
                console.error('Error updating course:', error);
                showAlert('Error updating course', 'error');
            }
        }

        async function toggleCourseStatus(id, currentStatus) {
            try {
                const newStatus = currentStatus === 'active' ? 'inactive' : 'active';
                const action = newStatus === 'active' ? 'publish' : 'unpublish';
                
                if (!confirm(`Are you sure you want to ${action} this course?`)) {
                    return;
                }

                const response = await fetch(`../backend/api/courses.php?id=${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        status: newStatus
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    await loadCoursesFromDatabase();
                    showAlert(`Course ${action}ed successfully!`, 'success');
                } else {
                    showAlert(`Error ${action}ing course: ` + result.message, 'error');
                }
                
            } catch (error) {
                console.error('Error toggling course status:', error);
                showAlert('Error updating course status', 'error');
            }
        }

        function viewCourse(id) {
            const course = courses.find(c => c.id === id);
            if (!course) return;

            const details = `
                <strong>Title:</strong> ${course.title}<br>
                <strong>Category:</strong> ${course.category}<br>
                <strong>Instructor:</strong> ${course.instructor}<br>
                <strong>Price:</strong> $${course.price}<br>
                <strong>Level:</strong> ${course.level}<br>
                <strong>Duration:</strong> ${course.duration}<br>
                <strong>Enrollments:</strong> ${course.enrollments}<br>
                <strong>Status:</strong> ${course.status}<br>
                <strong>Description:</strong> ${course.description}
            `;

            showAlert(`Course Details:<br><br>${details}`, 'info');
        }

        function duplicateCourse(id) {
            const course = courses.find(c => c.id === id);
            if (!course) return;

            const duplicatedCourse = {
                ...course,
                id: Date.now(),
                title: course.title + ' (Copy)',
                status: 'Draft',
                enrollments: 0,
                createdAt: new Date().toISOString(),
                lastModified: new Date().toISOString()
            };

            courses.push(duplicatedCourse);
            saveCourses();
            loadCourses();
            showAlert('Course duplicated successfully!', 'success');
        }

        async function deleteCourse(id) {
            try {
                const course = courses.find(c => c.id === id);
                const courseName = course ? course.title : 'this course';
                
                if (!confirm(`Are you sure you want to delete "${courseName}"? This action cannot be undone.`)) {
                    return;
                }

                const response = await fetch(`../backend/api/courses.php?id=${id}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                const result = await response.json();
                
                if (result.success) {
                    await loadCoursesFromDatabase();
                    showAlert('Course deleted successfully!', 'success');
                } else {
                    showAlert('Error deleting course: ' + result.message, 'error');
                }
                
            } catch (error) {
                console.error('Error deleting course:', error);
                showAlert('Error deleting course', 'error');
            }
        }

        // Helper Functions
        function saveCourses() {
            localStorage.setItem('edumentor_admin_courses', JSON.stringify(courses));
        }

        function resetForm() {
            document.getElementById('addCourseForm').reset();
        }

        function closeModal() {
            document.getElementById('addCourseModal').classList.remove('active');
            document.getElementById('addCourseModal').setAttribute('aria-hidden', 'true');
            resetForm();
            editingCourseId = null;
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString();
        }

        function showAlert(message, type = 'info') {
            // Create alert element
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            // Add to page
            document.body.appendChild(alert);
            
            // Position and show
            alert.style.position = 'fixed';
            alert.style.top = '20px';
            alert.style.right = '20px';
            alert.style.zIndex = '10000';
            alert.style.opacity = '0';
            alert.style.transform = 'translateX(100%)';
            alert.style.transition = 'all 0.3s ease';
            
            // Animate in
            setTimeout(() => {
                alert.style.opacity = '1';
                alert.style.transform = 'translateX(0)';
            }, 100);
            
            // Auto remove
            setTimeout(() => {
                alert.style.opacity = '0';
                alert.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (alert.parentNode) {
                        alert.parentNode.removeChild(alert);
                    }
                }, 300);
            }, 3000);
        }
    </script>
</body>
</html>
