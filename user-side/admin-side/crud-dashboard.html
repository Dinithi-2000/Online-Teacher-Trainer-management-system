<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD Management Dashboard - EduMentor Pro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .sidebar {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .nav-link {
            color: white !important;
        }
        .nav-link:hover, .nav-link.active {
            background-color: rgba(255,255,255,0.2);
            border-radius: 8px;
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .stats-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 15px;
        }
        .table-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .btn-crud {
            margin: 2px;
        }
        .search-box {
            max-width: 300px;
        }
        .status-badge {
            font-size: 0.8em;
        }
        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        .pagination-container {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-top: 20px;
        }
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        .alert {
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 sidebar p-3">
                <h4 class="text-white mb-4">
                    <i class="fas fa-cogs"></i> CRUD Manager
                </h4>
                
                <ul class="nav nav-pills flex-column">
                    <li class="nav-item mb-2">
                        <a class="nav-link active" href="#" data-section="dashboard">
                            <i class="fas fa-tachometer-alt me-2"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item mb-2">
                        <a class="nav-link" href="#" data-section="users">
                            <i class="fas fa-users me-2"></i> Users
                        </a>
                    </li>
                    <li class="nav-item mb-2">
                        <a class="nav-link" href="#" data-section="contacts">
                            <i class="fas fa-envelope me-2"></i> Contacts
                        </a>
                    </li>
                    <li class="nav-item mb-2">
                        <a class="nav-link" href="#" data-section="courses">
                            <i class="fas fa-book me-2"></i> Courses
                        </a>
                    </li>
                    <li class="nav-item mb-2">
                        <a class="nav-link" href="#" data-section="trainers">
                            <i class="fas fa-chalkboard-teacher me-2"></i> Trainers
                        </a>
                    </li>
                    <li class="nav-item mb-2">
                        <a class="nav-link" href="#" data-section="blogs">
                            <i class="fas fa-blog me-2"></i> Blogs
                        </a>
                    </li>
                </ul>
            </div>
            
            <!-- Main Content -->
            <div class="col-md-9 col-lg-10 p-4">
                <!-- Dashboard Section -->
                <div id="dashboard" class="content-section active">
                    <h2 class="mb-4">Dashboard Overview</h2>
                    
                    <div class="row mb-4">
                        <div class="col-md-3 mb-3">
                            <div class="card stats-card">
                                <div class="card-body text-center">
                                    <i class="fas fa-users fa-2x mb-2"></i>
                                    <h4 id="stats-users">0</h4>
                                    <p class="mb-0">Total Users</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card stats-card">
                                <div class="card-body text-center">
                                    <i class="fas fa-envelope fa-2x mb-2"></i>
                                    <h4 id="stats-contacts">0</h4>
                                    <p class="mb-0">Contact Messages</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card stats-card">
                                <div class="card-body text-center">
                                    <i class="fas fa-book fa-2x mb-2"></i>
                                    <h4 id="stats-courses">0</h4>
                                    <p class="mb-0">Total Courses</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card stats-card">
                                <div class="card-body text-center">
                                    <i class="fas fa-blog fa-2x mb-2"></i>
                                    <h4 id="stats-blogs">0</h4>
                                    <p class="mb-0">Blog Posts</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-12">
                            <div class="table-container">
                                <h5>Recent Activity</h5>
                                <div id="recent-activity">
                                    <p class="text-muted">Loading recent activity...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Users Section -->
                <div id="users" class="content-section">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>User Management</h2>
                        <button class="btn btn-primary" onclick="showCreateModal('user')">
                            <i class="fas fa-plus"></i> Add User
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="input-group search-box">
                                    <input type="text" class="form-control" id="users-search" placeholder="Search users...">
                                    <button class="btn btn-outline-secondary" onclick="searchData('users')">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-6 text-end">
                                <select class="form-select" id="users-filter" style="max-width: 200px; display: inline-block;">
                                    <option value="">All Roles</option>
                                    <option value="admin">Admin</option>
                                    <option value="trainer">Trainer</option>
                                    <option value="student">Student</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="loading" id="users-loading">
                            <i class="fas fa-spinner fa-spin"></i> Loading...
                        </div>
                        
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead class="table-dark">
                                    <tr>
                                        <th>ID</th>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Role</th>
                                        <th>Status</th>
                                        <th>Created</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="users-table-body">
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="pagination-container">
                            <div id="users-pagination"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Contacts Section -->
                <div id="contacts" class="content-section">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>Contact Messages</h2>
                        <button class="btn btn-danger" onclick="bulkDeleteContacts()">
                            <i class="fas fa-trash"></i> Bulk Delete
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="input-group search-box">
                                    <input type="text" class="form-control" id="contacts-search" placeholder="Search contacts...">
                                    <button class="btn btn-outline-secondary" onclick="searchData('contacts')">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-6 text-end">
                                <select class="form-select" id="contacts-filter" style="max-width: 200px; display: inline-block;">
                                    <option value="">All Status</option>
                                    <option value="new">New</option>
                                    <option value="read">Read</option>
                                    <option value="replied">Replied</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="loading" id="contacts-loading">
                            <i class="fas fa-spinner fa-spin"></i> Loading...
                        </div>
                        
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead class="table-dark">
                                    <tr>
                                        <th><input type="checkbox" id="contacts-select-all"></th>
                                        <th>ID</th>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Subject</th>
                                        <th>Status</th>
                                        <th>Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="contacts-table-body">
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="pagination-container">
                            <div id="contacts-pagination"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Courses Section -->
                <div id="courses" class="content-section">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>Course Management</h2>
                        <button class="btn btn-primary" onclick="showCreateModal('course')">
                            <i class="fas fa-plus"></i> Add Course
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="input-group search-box">
                                    <input type="text" class="form-control" id="courses-search" placeholder="Search courses...">
                                    <button class="btn btn-outline-secondary" onclick="searchData('courses')">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-6 text-end">
                                <select class="form-select" id="courses-filter" style="max-width: 200px; display: inline-block;">
                                    <option value="">All Status</option>
                                    <option value="active">Active</option>
                                    <option value="draft">Draft</option>
                                    <option value="archived">Archived</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="loading" id="courses-loading">
                            <i class="fas fa-spinner fa-spin"></i> Loading...
                        </div>
                        
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead class="table-dark">
                                    <tr>
                                        <th>ID</th>
                                        <th>Title</th>
                                        <th>Instructor</th>
                                        <th>Category</th>
                                        <th>Price</th>
                                        <th>Status</th>
                                        <th>Created</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="courses-table-body">
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="pagination-container">
                            <div id="courses-pagination"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Trainers Section -->
                <div id="trainers" class="content-section">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>Trainer Management</h2>
                        <button class="btn btn-primary" onclick="showCreateModal('trainer')">
                            <i class="fas fa-plus"></i> Add Trainer
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="input-group search-box">
                                    <input type="text" class="form-control" id="trainers-search" placeholder="Search trainers...">
                                    <button class="btn btn-outline-secondary" onclick="searchData('trainers')">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="loading" id="trainers-loading">
                            <i class="fas fa-spinner fa-spin"></i> Loading...
                        </div>
                        
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead class="table-dark">
                                    <tr>
                                        <th>ID</th>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Specialization</th>
                                        <th>Experience</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="trainers-table-body">
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="pagination-container">
                            <div id="trainers-pagination"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Blogs Section -->
                <div id="blogs" class="content-section">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>Blog Management</h2>
                        <button class="btn btn-primary" onclick="showCreateModal('blog')">
                            <i class="fas fa-plus"></i> Add Blog Post
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="input-group search-box">
                                    <input type="text" class="form-control" id="blogs-search" placeholder="Search blogs...">
                                    <button class="btn btn-outline-secondary" onclick="searchData('blogs')">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-6 text-end">
                                <select class="form-select" id="blogs-filter" style="max-width: 200px; display: inline-block;">
                                    <option value="">All Status</option>
                                    <option value="published">Published</option>
                                    <option value="draft">Draft</option>
                                    <option value="archived">Archived</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="loading" id="blogs-loading">
                            <i class="fas fa-spinner fa-spin"></i> Loading...
                        </div>
                        
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead class="table-dark">
                                    <tr>
                                        <th>ID</th>
                                        <th>Title</th>
                                        <th>Author</th>
                                        <th>Category</th>
                                        <th>Status</th>
                                        <th>Published</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="blogs-table-body">
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="pagination-container">
                            <div id="blogs-pagination"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Universal Modal for Create/Edit -->
    <div class="modal fade" id="crudModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">Create Item</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="crudForm">
                        <div id="modalFields">
                            <!-- Dynamic fields will be inserted here -->
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveCrudItem()">Save</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Contact View Modal -->
    <div class="modal fade" id="contactViewModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Contact Message Details</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="contactViewContent">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="markAsReplied()">Mark as Replied</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast for notifications -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="toast" class="toast" role="alert">
            <div class="toast-header">
                <strong class="me-auto">Notification</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="toast-body">
                Message here
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global variables
        let currentSection = 'dashboard';
        let currentModal = '';
        let currentEditId = null;
        let currentPage = { users: 1, contacts: 1, courses: 1, trainers: 1, blogs: 1 };
        let selectedContacts = [];
        
        // API base URL
        const API_BASE = '../backend/api/';
        
        // Initialize the dashboard
        document.addEventListener('DOMContentLoaded', function() {
            setupNavigation();
            loadDashboardStats();
            loadData('users');
        });
        
        // Navigation setup
        function setupNavigation() {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Update active nav
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show section
                    const section = this.dataset.section;
                    showSection(section);
                });
            });
        }
        
        // Show section
        function showSection(section) {
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            document.getElementById(section).classList.add('active');
            
            currentSection = section;
            
            if (section !== 'dashboard') {
                loadData(section);
            }
        }
        
        // Load dashboard stats
        async function loadDashboardStats() {
            try {
                // Load stats for each module
                const endpoints = {
                    users: 'users.php?action=stats',
                    contacts: 'contacts.php?action=stats',
                    courses: 'courses.php?action=stats',
                    blogs: 'blog.php?action=stats'
                };
                
                for (const [module, endpoint] of Object.entries(endpoints)) {
                    try {
                        const response = await fetch(API_BASE + endpoint);
                        const data = await response.json();
                        
                        if (data.success) {
                            const statElement = document.getElementById(`stats-${module}`);
                            if (statElement) {
                                statElement.textContent = data.data.total || data.data.total_count || 0;
                            }
                        }
                    } catch (error) {
                        console.error(`Error loading ${module} stats:`, error);
                    }
                }
            } catch (error) {
                console.error('Error loading dashboard stats:', error);
            }
        }
        
        // Load data for a section
        async function loadData(section, page = 1) {
            const loadingElement = document.getElementById(`${section}-loading`);
            const tableBody = document.getElementById(`${section}-table-body`);
            
            if (loadingElement) loadingElement.style.display = 'block';
            
            try {
                let endpoint = `${section}.php?action=list&page=${page}`;
                
                // Add filters if present
                const filter = document.getElementById(`${section}-filter`);
                if (filter && filter.value) {
                    endpoint += `&filter=${filter.value}`;
                }
                
                const search = document.getElementById(`${section}-search`);
                if (search && search.value) {
                    endpoint += `&search=${encodeURIComponent(search.value)}`;
                }
                
                const response = await fetch(API_BASE + endpoint);
                const data = await response.json();
                
                if (data.success) {
                    renderTable(section, data.data);
                    renderPagination(section, data.pagination);
                } else {
                    showToast('Error loading data: ' + data.message, 'error');
                }
            } catch (error) {
                console.error(`Error loading ${section}:`, error);
                showToast('Error loading data', 'error');
            } finally {
                if (loadingElement) loadingElement.style.display = 'none';
            }
        }
        
        // Render table data
        function renderTable(section, data) {
            const tableBody = document.getElementById(`${section}-table-body`);
            
            if (!Array.isArray(data) || data.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="8" class="text-center">No data found</td></tr>';
                return;
            }
            
            let html = '';
            
            data.forEach(item => {
                switch (section) {
                    case 'users':
                        html += renderUserRow(item);
                        break;
                    case 'contacts':
                        html += renderContactRow(item);
                        break;
                    case 'courses':
                        html += renderCourseRow(item);
                        break;
                    case 'trainers':
                        html += renderTrainerRow(item);
                        break;
                    case 'blogs':
                        html += renderBlogRow(item);
                        break;
                }
            });
            
            tableBody.innerHTML = html;
        }
        
        // Render user row
        function renderUserRow(user) {
            const statusBadge = getStatusBadge(user.status);
            const createdDate = new Date(user.created_at).toLocaleDateString();
            
            return `
                <tr>
                    <td>${user.id}</td>
                    <td>${user.first_name} ${user.last_name}</td>
                    <td>${user.email}</td>
                    <td><span class="badge bg-info">${user.role}</span></td>
                    <td>${statusBadge}</td>
                    <td>${createdDate}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary btn-crud" onclick="editItem('user', ${user.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger btn-crud" onclick="deleteItem('users', ${user.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `;
        }
        
        // Render contact row
        function renderContactRow(contact) {
            const statusBadge = getStatusBadge(contact.status);
            const createdDate = new Date(contact.created_at).toLocaleDateString();
            
            return `
                <tr>
                    <td><input type="checkbox" value="${contact.id}" onchange="toggleContactSelection(${contact.id})"></td>
                    <td>${contact.id}</td>
                    <td>${contact.name}</td>
                    <td>${contact.email}</td>
                    <td>${contact.subject}</td>
                    <td>${statusBadge}</td>
                    <td>${createdDate}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary btn-crud" onclick="viewContact(${contact.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger btn-crud" onclick="deleteItem('contacts', ${contact.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `;
        }
        
        // Render course row
        function renderCourseRow(course) {
            const statusBadge = getStatusBadge(course.status);
            const createdDate = new Date(course.created_at).toLocaleDateString();
            
            return `
                <tr>
                    <td>${course.id}</td>
                    <td>${course.title}</td>
                    <td>${course.instructor_name || 'N/A'}</td>
                    <td>${course.category}</td>
                    <td>$${course.price}</td>
                    <td>${statusBadge}</td>
                    <td>${createdDate}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary btn-crud" onclick="editItem('course', ${course.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger btn-crud" onclick="deleteItem('courses', ${course.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `;
        }
        
        // Render trainer row
        function renderTrainerRow(trainer) {
            return `
                <tr>
                    <td>${trainer.id}</td>
                    <td>${trainer.name}</td>
                    <td>${trainer.email}</td>
                    <td>${trainer.specialization}</td>
                    <td>${trainer.experience} years</td>
                    <td>${getStatusBadge(trainer.status || 'active')}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary btn-crud" onclick="editItem('trainer', ${trainer.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger btn-crud" onclick="deleteItem('trainers', ${trainer.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `;
        }
        
        // Render blog row
        function renderBlogRow(blog) {
            const statusBadge = getStatusBadge(blog.status);
            const publishedDate = blog.created_at ? new Date(blog.created_at).toLocaleDateString() : 'N/A';
            
            return `
                <tr>
                    <td>${blog.id}</td>
                    <td>${blog.title}</td>
                    <td>${blog.author || 'Admin'}</td>
                    <td>${blog.category || 'General'}</td>
                    <td>${statusBadge}</td>
                    <td>${publishedDate}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary btn-crud" onclick="editItem('blog', ${blog.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger btn-crud" onclick="deleteItem('blogs', ${blog.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `;
        }
        
        // Get status badge
        function getStatusBadge(status) {
            const statusMap = {
                'active': 'bg-success',
                'inactive': 'bg-secondary',
                'pending': 'bg-warning',
                'new': 'bg-primary',
                'read': 'bg-info',
                'replied': 'bg-success',
                'published': 'bg-success',
                'draft': 'bg-warning',
                'archived': 'bg-secondary'
            };
            
            const className = statusMap[status] || 'bg-secondary';
            return `<span class="badge ${className} status-badge">${status}</span>`;
        }
        
        // Show create modal
        function showCreateModal(type) {
            currentModal = type;
            currentEditId = null;
            
            document.getElementById('modalTitle').textContent = `Create ${type.charAt(0).toUpperCase() + type.slice(1)}`;
            generateModalFields(type);
            
            const modal = new bootstrap.Modal(document.getElementById('crudModal'));
            modal.show();
        }
        
        // Edit item
        async function editItem(type, id) {
            currentModal = type;
            currentEditId = id;
            
            document.getElementById('modalTitle').textContent = `Edit ${type.charAt(0).toUpperCase() + type.slice(1)}`;
            
            try {
                let endpoint = '';
                switch (type) {
                    case 'user':
                        endpoint = `users.php?action=get&id=${id}`;
                        break;
                    case 'course':
                        endpoint = `courses.php?action=get&id=${id}`;
                        break;
                    case 'trainer':
                        endpoint = `trainers.php?action=get&id=${id}`;
                        break;
                    case 'blog':
                        endpoint = `blog.php?action=get&id=${id}`;
                        break;
                }
                
                const response = await fetch(API_BASE + endpoint);
                const data = await response.json();
                
                if (data.success) {
                    generateModalFields(type, data.data);
                    const modal = new bootstrap.Modal(document.getElementById('crudModal'));
                    modal.show();
                } else {
                    showToast('Error loading item: ' + data.message, 'error');
                }
            } catch (error) {
                console.error('Error loading item:', error);
                showToast('Error loading item', 'error');
            }
        }
        
        // Generate modal fields
        function generateModalFields(type, data = {}) {
            const fieldsContainer = document.getElementById('modalFields');
            let html = '';
            
            switch (type) {
                case 'user':
                    html = `
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Username</label>
                                    <input type="text" class="form-control" name="username" value="${data.username || ''}" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-control" name="email" value="${data.email || ''}" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">First Name</label>
                                    <input type="text" class="form-control" name="first_name" value="${data.first_name || ''}" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Last Name</label>
                                    <input type="text" class="form-control" name="last_name" value="${data.last_name || ''}" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Role</label>
                                    <select class="form-control" name="role" required>
                                        <option value="student" ${data.role === 'student' ? 'selected' : ''}>Student</option>
                                        <option value="trainer" ${data.role === 'trainer' ? 'selected' : ''}>Trainer</option>
                                        <option value="admin" ${data.role === 'admin' ? 'selected' : ''}>Admin</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Status</label>
                                    <select class="form-control" name="status" required>
                                        <option value="active" ${data.status === 'active' ? 'selected' : ''}>Active</option>
                                        <option value="inactive" ${data.status === 'inactive' ? 'selected' : ''}>Inactive</option>
                                        <option value="pending" ${data.status === 'pending' ? 'selected' : ''}>Pending</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        ${!currentEditId ? `
                        <div class="mb-3">
                            <label class="form-label">Password</label>
                            <input type="password" class="form-control" name="password" required>
                        </div>
                        ` : `
                        <div class="mb-3">
                            <label class="form-label">Password (leave blank to keep current)</label>
                            <input type="password" class="form-control" name="password">
                        </div>
                        `}
                        <div class="mb-3">
                            <label class="form-label">Bio</label>
                            <textarea class="form-control" name="bio" rows="3">${data.bio || ''}</textarea>
                        </div>
                    `;
                    break;
                    
                case 'course':
                    html = `
                        <div class="mb-3">
                            <label class="form-label">Course Title</label>
                            <input type="text" class="form-control" name="title" value="${data.title || ''}" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" name="description" rows="4">${data.description || ''}</textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Category</label>
                                    <input type="text" class="form-control" name="category" value="${data.category || ''}" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Price</label>
                                    <input type="number" class="form-control" name="price" value="${data.price || ''}" step="0.01" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Duration (hours)</label>
                                    <input type="number" class="form-control" name="duration" value="${data.duration || ''}" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Status</label>
                                    <select class="form-control" name="status" required>
                                        <option value="active" ${data.status === 'active' ? 'selected' : ''}>Active</option>
                                        <option value="draft" ${data.status === 'draft' ? 'selected' : ''}>Draft</option>
                                        <option value="archived" ${data.status === 'archived' ? 'selected' : ''}>Archived</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Image URL</label>
                            <input type="url" class="form-control" name="image_url" value="${data.image_url || ''}">
                        </div>
                    `;
                    break;
                    
                case 'trainer':
                    html = `
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Name</label>
                                    <input type="text" class="form-control" name="name" value="${data.name || ''}" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-control" name="email" value="${data.email || ''}" required>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Specialization</label>
                            <input type="text" class="form-control" name="specialization" value="${data.specialization || ''}" required>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Experience (years)</label>
                                    <input type="number" class="form-control" name="experience" value="${data.experience || ''}" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Phone</label>
                                    <input type="tel" class="form-control" name="phone" value="${data.phone || ''}">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Bio</label>
                            <textarea class="form-control" name="bio" rows="4">${data.bio || ''}</textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Profile Image URL</label>
                            <input type="url" class="form-control" name="image_url" value="${data.image_url || ''}">
                        </div>
                    `;
                    break;
                    
                case 'blog':
                    html = `
                        <div class="mb-3">
                            <label class="form-label">Blog Title</label>
                            <input type="text" class="form-control" name="title" value="${data.title || ''}" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Content</label>
                            <textarea class="form-control" name="content" rows="8">${data.content || ''}" required></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Category</label>
                                    <input type="text" class="form-control" name="category" value="${data.category || ''}" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Status</label>
                                    <select class="form-control" name="status" required>
                                        <option value="published" ${data.status === 'published' ? 'selected' : ''}>Published</option>
                                        <option value="draft" ${data.status === 'draft' ? 'selected' : ''}>Draft</option>
                                        <option value="archived" ${data.status === 'archived' ? 'selected' : ''}>Archived</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Featured Image URL</label>
                            <input type="url" class="form-control" name="image_url" value="${data.image_url || ''}">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Excerpt</label>
                            <textarea class="form-control" name="excerpt" rows="3">${data.excerpt || ''}</textarea>
                        </div>
                    `;
                    break;
            }
            
            fieldsContainer.innerHTML = html;
        }
        
        // Save CRUD item
        async function saveCrudItem() {
            const form = document.getElementById('crudForm');
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            
            try {
                let endpoint = '';
                let method = 'POST';
                
                if (currentEditId) {
                    method = 'PUT';
                    switch (currentModal) {
                        case 'user':
                            endpoint = `users.php?action=update&id=${currentEditId}`;
                            break;
                        case 'course':
                            endpoint = `courses.php?action=update&id=${currentEditId}`;
                            break;
                        case 'trainer':
                            endpoint = `trainers.php?action=update&id=${currentEditId}`;
                            break;
                        case 'blog':
                            endpoint = `blog.php?action=update&id=${currentEditId}`;
                            break;
                    }
                } else {
                    switch (currentModal) {
                        case 'user':
                            endpoint = 'users.php?action=create';
                            break;
                        case 'course':
                            endpoint = 'courses.php?action=create';
                            break;
                        case 'trainer':
                            endpoint = 'trainers.php?action=create';
                            break;
                        case 'blog':
                            endpoint = 'blog.php?action=create';
                            break;
                    }
                }
                
                const response = await fetch(API_BASE + endpoint, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showToast(result.message || 'Item saved successfully', 'success');
                    bootstrap.Modal.getInstance(document.getElementById('crudModal')).hide();
                    
                    // Reload data for current section
                    const pluralSection = currentModal + 's';
                    if (pluralSection === 'users' || pluralSection === 'courses' || pluralSection === 'trainers' || pluralSection === 'blogs') {
                        loadData(pluralSection);
                    }
                    
                    // Reload dashboard stats
                    loadDashboardStats();
                } else {
                    showToast('Error: ' + result.message, 'error');
                }
            } catch (error) {
                console.error('Error saving item:', error);
                showToast('Error saving item', 'error');
            }
        }
        
        // Delete item
        async function deleteItem(section, id) {
            if (!confirm('Are you sure you want to delete this item?')) {
                return;
            }
            
            try {
                const response = await fetch(API_BASE + `${section}.php?action=delete&id=${id}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showToast('Item deleted successfully', 'success');
                    loadData(section);
                    loadDashboardStats();
                } else {
                    showToast('Error: ' + result.message, 'error');
                }
            } catch (error) {
                console.error('Error deleting item:', error);
                showToast('Error deleting item', 'error');
            }
        }
        
        // Search data
        function searchData(section) {
            loadData(section);
        }
        
        // Handle filter change
        document.addEventListener('change', function(e) {
            if (e.target.id.includes('-filter')) {
                const section = e.target.id.replace('-filter', '');
                loadData(section);
            }
        });
        
        // Handle enter key in search boxes
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && e.target.id.includes('-search')) {
                const section = e.target.id.replace('-search', '');
                loadData(section);
            }
        });
        
        // Contact specific functions
        function toggleContactSelection(id) {
            const index = selectedContacts.indexOf(id);
            if (index > -1) {
                selectedContacts.splice(index, 1);
            } else {
                selectedContacts.push(id);
            }
        }
        
        function bulkDeleteContacts() {
            if (selectedContacts.length === 0) {
                showToast('Please select contacts to delete', 'warning');
                return;
            }
            
            if (!confirm(`Are you sure you want to delete ${selectedContacts.length} contacts?`)) {
                return;
            }
            
            // Implement bulk delete
            // This would need to be added to the contacts API
            showToast('Bulk delete functionality to be implemented', 'info');
        }
        
        async function viewContact(id) {
            try {
                const response = await fetch(API_BASE + `contacts.php?action=get&id=${id}`);
                const data = await response.json();
                
                if (data.success) {
                    const contact = data.data;
                    document.getElementById('contactViewContent').innerHTML = `
                        <div class="row">
                            <div class="col-md-6"><strong>Name:</strong> ${contact.name}</div>
                            <div class="col-md-6"><strong>Email:</strong> ${contact.email}</div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-md-6"><strong>Phone:</strong> ${contact.phone || 'N/A'}</div>
                            <div class="col-md-6"><strong>Date:</strong> ${new Date(contact.created_at).toLocaleString()}</div>
                        </div>
                        <div class="mt-3">
                            <strong>Subject:</strong> ${contact.subject}
                        </div>
                        <div class="mt-3">
                            <strong>Message:</strong>
                            <div class="mt-2 p-3 bg-light rounded">${contact.message}</div>
                        </div>
                    `;
                    
                    const modal = new bootstrap.Modal(document.getElementById('contactViewModal'));
                    modal.show();
                } else {
                    showToast('Error loading contact: ' + data.message, 'error');
                }
            } catch (error) {
                console.error('Error loading contact:', error);
                showToast('Error loading contact', 'error');
            }
        }
        
        // Pagination
        function renderPagination(section, pagination) {
            if (!pagination) return;
            
            const container = document.getElementById(`${section}-pagination`);
            if (!container) return;
            
            let html = '<nav><ul class="pagination pagination-sm">';
            
            // Previous button
            if (pagination.page > 1) {
                html += `<li class="page-item"><a class="page-link" href="#" onclick="loadData('${section}', ${pagination.page - 1})">Previous</a></li>`;
            }
            
            // Page numbers
            for (let i = Math.max(1, pagination.page - 2); i <= Math.min(pagination.pages, pagination.page + 2); i++) {
                const active = i === pagination.page ? 'active' : '';
                html += `<li class="page-item ${active}"><a class="page-link" href="#" onclick="loadData('${section}', ${i})">${i}</a></li>`;
            }
            
            // Next button
            if (pagination.page < pagination.pages) {
                html += `<li class="page-item"><a class="page-link" href="#" onclick="loadData('${section}', ${pagination.page + 1})">Next</a></li>`;
            }
            
            html += '</ul></nav>';
            
            // Add total records info
            html += `<small class="text-muted">Showing ${((pagination.page - 1) * pagination.limit) + 1} to ${Math.min(pagination.page * pagination.limit, pagination.total)} of ${pagination.total} entries</small>`;
            
            container.innerHTML = html;
        }
        
        // Show toast notification
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            const toastBody = document.getElementById('toast-body');
            
            // Set message
            toastBody.textContent = message;
            
            // Set type-specific styling
            toast.className = 'toast';
            if (type === 'success') {
                toast.classList.add('bg-success', 'text-white');
            } else if (type === 'error') {
                toast.classList.add('bg-danger', 'text-white');
            } else if (type === 'warning') {
                toast.classList.add('bg-warning');
            } else {
                toast.classList.add('bg-info', 'text-white');
            }
            
            // Show toast
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
        }
    </script>
</body>
</html>
