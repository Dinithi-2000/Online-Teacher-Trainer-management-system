<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Users Management - EduMentor Pro Admin</title>
    
    <!-- CSS -->
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/admin-styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body class="admin-body">
    <!-- Admin Header -->
    <header class="admin-header">
        <div class="admin-header-content">
            <div class="admin-brand">
                <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Toggle menu">
                    <i class="fas fa-bars"></i>
                </button>
                <i class="fas fa-shield-alt"></i>
                <span class="brand-text">EduMentor Pro</span>
                <span class="admin-badge">Admin</span>
            </div>
            
            <div class="header-search">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Search users..." id="globalSearch">
                </div>
            </div>
            
            <div class="header-actions">
                <button class="notification-btn" title="Notifications">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge">3</span>
                </button>
                
                <div class="admin-profile">
                    <img src="../assets/images/admin-avatar.jpg" alt="Admin" class="admin-avatar">
                    <div class="admin-details">
                        <span class="admin-name">John Admin</span>
                        <span class="admin-role">Super Admin</span>
                    </div>
                    <i class="fas fa-chevron-down"></i>
                </div>
            </div>
        </div>
    </header>

    <!-- Admin Layout -->
    <div class="admin-layout">
        <!-- Sidebar -->
        <aside class="admin-sidebar">
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <h3>Main</h3>
                    <ul>
                        <li><a href="index.html" class="nav-link">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>Dashboard</span>
                        </a></li>
                        <li><a href="analytics.html" class="nav-link">
                            <i class="fas fa-chart-line"></i>
                            <span>Analytics</span>
                        </a></li>
                    </ul>
                </div>
                
                <div class="nav-section">
                    <h3>Content Management</h3>
                    <ul>
                        <li><a href="courses.html" class="nav-link">
                            <i class="fas fa-book"></i>
                            <span>Courses</span>
                            <span class="nav-badge">24</span>
                        </a></li>
                        <li><a href="trainers.html" class="nav-link">
                            <i class="fas fa-chalkboard-teacher"></i>
                            <span>Trainers</span>
                            <span class="nav-badge">12</span>
                        </a></li>
                        <li><a href="blog.html" class="nav-link">
                            <i class="fas fa-blog"></i>
                            <span>Blog Posts</span>
                        </a></li>
                        <li><a href="resources.html" class="nav-link">
                            <i class="fas fa-file-alt"></i>
                            <span>Resources</span>
                        </a></li>
                    </ul>
                </div>
                
                <div class="nav-section">
                    <h3>User Management</h3>
                    <ul>
                        <li><a href="users.html" class="nav-link active">
                            <i class="fas fa-users"></i>
                            <span>Users</span>
                            <span class="nav-badge">1.2K</span>
                        </a></li>
                        <li><a href="roles.html" class="nav-link">
                            <i class="fas fa-user-shield"></i>
                            <span>Roles & Permissions</span>
                        </a></li>
                        <li><a href="registrations.html" class="nav-link">
                            <i class="fas fa-user-plus"></i>
                            <span>Registrations</span>
                            <span class="nav-badge new">5</span>
                        </a></li>
                    </ul>
                </div>
                
                <div class="nav-section">
                    <h3>Learning Management</h3>
                    <ul>
                        <li><a href="enrollments.html" class="nav-link">
                            <i class="fas fa-graduation-cap"></i>
                            <span>Enrollments</span>
                        </a></li>
                        <li><a href="certifications.html" class="nav-link">
                            <i class="fas fa-certificate"></i>
                            <span>Certifications</span>
                        </a></li>
                        <li><a href="progress.html" class="nav-link">
                            <i class="fas fa-tasks"></i>
                            <span>Progress Tracking</span>
                        </a></li>
                        <li><a href="assessments.html" class="nav-link">
                            <i class="fas fa-clipboard-check"></i>
                            <span>Assessments</span>
                        </a></li>
                    </ul>
                </div>
                
                <div class="nav-section">
                    <h3>Community</h3>
                    <ul>
                        <li><a href="forum.html" class="nav-link">
                            <i class="fas fa-comments"></i>
                            <span>Forum Management</span>
                        </a></li>
                        <li><a href="discussions.html" class="nav-link">
                            <i class="fas fa-comment-dots"></i>
                            <span>Discussions</span>
                        </a></li>
                        <li><a href="moderation.html" class="nav-link">
                            <i class="fas fa-eye"></i>
                            <span>Content Moderation</span>
                        </a></li>
                    </ul>
                </div>
                
                <div class="nav-section">
                    <h3>System</h3>
                    <ul>
                        <li><a href="settings.html" class="nav-link">
                            <i class="fas fa-cogs"></i>
                            <span>Settings</span>
                        </a></li>
                        <li><a href="backups.html" class="nav-link">
                            <i class="fas fa-database"></i>
                            <span>Backups</span>
                        </a></li>
                        <li><a href="logs.html" class="nav-link">
                            <i class="fas fa-file-alt"></i>
                            <span>System Logs</span>
                        </a></li>
                        <li><a href="maintenance.html" class="nav-link">
                            <i class="fas fa-tools"></i>
                            <span>Maintenance</span>
                        </a></li>
                    </ul>
                </div>
            </nav>
            
            <div class="sidebar-footer">
                <a href="../user-side/index.html" class="btn btn-outline btn-sm">
                    <i class="fas fa-external-link-alt"></i> View Site
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="admin-main">
            <div class="page-header">
                <div class="page-title">
                    <h1>Users Management</h1>
                    <p>Manage student accounts, activity, and permissions</p>
                </div>
                
                <div class="page-actions">
                    <button class="btn btn-outline">
                        <i class="fas fa-download"></i> Export Users
                    </button>
                    <button class="btn btn-primary" onclick="openAddUserModal()">
                        <i class="fas fa-plus"></i> Add User
                    </button>
                </div>
            </div>

            <!-- User Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-details">
                        <h3>1,234</h3>
                        <p>Total Users</p>
                        <span class="stat-change positive">+12%</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-user-check"></i>
                    </div>
                    <div class="stat-details">
                        <h3>1,156</h3>
                        <p>Active Users</p>
                        <span class="stat-change positive">+8%</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-user-plus"></i>
                    </div>
                    <div class="stat-details">
                        <h3>47</h3>
                        <p>New This Month</p>
                        <span class="stat-change positive">+25%</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-user-times"></i>
                    </div>
                    <div class="stat-details">
                        <h3>78</h3>
                        <p>Inactive Users</p>
                        <span class="stat-change negative">-5%</span>
                    </div>
                </div>
            </div>

            <!-- User Activity Summary -->
            <div class="activity-summary">
                <div class="activity-card">
                    <h3>Recent Activity</h3>
                    <div class="activity-list">
                        <div class="activity-item">
                            <div class="activity-avatar">
                                <img src="../assets/images/user1.jpg" alt="User">
                            </div>
                            <div class="activity-details">
                                <p><strong>Sarah Wilson</strong> completed "JavaScript Fundamentals"</p>
                                <span class="activity-time">2 hours ago</span>
                            </div>
                        </div>
                        
                        <div class="activity-item">
                            <div class="activity-avatar">
                                <img src="../assets/images/user2.jpg" alt="User">
                            </div>
                            <div class="activity-details">
                                <p><strong>Mike Johnson</strong> enrolled in "React Development"</p>
                                <span class="activity-time">4 hours ago</span>
                            </div>
                        </div>
                        
                        <div class="activity-item">
                            <div class="activity-avatar">
                                <img src="../assets/images/user3.jpg" alt="User">
                            </div>
                            <div class="activity-details">
                                <p><strong>Emma Davis</strong> earned a certificate</p>
                                <span class="activity-time">6 hours ago</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="activity-card">
                    <h3>User Distribution</h3>
                    <div class="distribution-chart">
                        <div class="distribution-item">
                            <span class="label">Students</span>
                            <div class="bar">
                                <div class="fill" data-percentage="78"></div>
                            </div>
                            <span class="percentage">78%</span>
                        </div>
                        
                        <div class="distribution-item">
                            <span class="label">Instructors</span>
                            <div class="bar">
                                <div class="fill" data-percentage="15"></div>
                            </div>
                            <span class="percentage">15%</span>
                        </div>
                        
                        <div class="distribution-item">
                            <span class="label">Admins</span>
                            <div class="bar">
                                <div class="fill" data-percentage="7"></div>
                            </div>
                            <span class="percentage">7%</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Users Table -->
            <div class="content-card">
                <div class="card-header">
                    <h3>All Users</h3>
                    
                    <div class="filters">
                        <div class="filter-group">
                            <select class="form-control" aria-label="Filter by status">
                                <option value="">All Status</option>
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                                <option value="banned">Banned</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <select class="form-control" aria-label="Filter by role">
                                <option value="">All Roles</option>
                                <option value="student">Student</option>
                                <option value="instructor">Instructor</option>
                                <option value="admin">Admin</option>
                            </select>
                        </div>
                        
                        <div class="search-group">
                            <i class="fas fa-search"></i>
                            <input type="text" class="form-control" placeholder="Search users...">
                        </div>
                    </div>
                </div>

                <div class="table-container">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>
                                    <input type="checkbox" id="selectAll">
                                </th>
                                <th>User</th>
                                <th>Role</th>
                                <th>Enrolled Courses</th>
                                <th>Last Activity</th>
                                <th>Join Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                        </tbody>
                    </table>
                </div>

                <div class="table-footer">
                    <div class="pagination-info">
                        Showing 1-4 of 1,234 users
                    </div>
                    <div class="pagination">
                        <button class="pagination-btn" disabled>
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <span class="pagination-pages">
                            <button class="pagination-btn active">1</button>
                            <button class="pagination-btn">2</button>
                            <button class="pagination-btn">3</button>
                            <button class="pagination-btn">...</button>
                            <button class="pagination-btn">25</button>
                        </span>
                        <button class="pagination-btn">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add/Edit User Modal -->
    <div class="modal" id="addUserModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Add New User</h3>
                <button class="modal-close" onclick="closeAddUserModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form class="modal-body" id="userForm" onsubmit="handleUserSubmit(event)">
                <input type="hidden" id="userId" name="userId">
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="firstName">First Name</label>
                        <input type="text" id="firstName" name="firstName" class="form-control" placeholder="Enter first name" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="lastName">Last Name</label>
                        <input type="text" id="lastName" name="lastName" class="form-control" placeholder="Enter last name" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="email">Email Address</label>
                    <input type="email" id="email" name="email" class="form-control" placeholder="Enter email address" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="role">Role</label>
                        <select id="role" name="role" class="form-control" required>
                            <option value="">Select role</option>
                            <option value="Student">Student</option>
                            <option value="Instructor">Instructor</option>
                            <option value="Admin">Admin</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="status">Status</label>
                        <select id="status" name="status" class="form-control" required>
                            <option value="Active">Active</option>
                            <option value="Inactive">Inactive</option>
                            <option value="Suspended">Suspended</option>
                        </select>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeAddUserModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="submitBtn">Add User</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Scripts -->
    <script src="../assets/js/main.js"></script>
    <script>
        // Modal Functions
        function openAddUserModal() {
            document.getElementById('addUserModal').style.display = 'flex';
            document.getElementById('userForm').reset();
            document.getElementById('modalTitle').textContent = 'Add New User';
            document.getElementById('userId').value = '';
        }

        function closeAddUserModal() {
            document.getElementById('addUserModal').style.display = 'none';
        }

        function openEditUserModal(userId) {
            const users = JSON.parse(localStorage.getItem('edumentor_admin_users') || '[]');
            const user = users.find(u => u.id == userId);
            
            if (user) {
                document.getElementById('modalTitle').textContent = 'Edit User';
                document.getElementById('userId').value = user.id;
                document.getElementById('firstName').value = user.firstName;
                document.getElementById('lastName').value = user.lastName;
                document.getElementById('email').value = user.email;
                document.getElementById('role').value = user.role;
                document.getElementById('status').value = user.status;
                document.getElementById('addUserModal').style.display = 'flex';
            }
        }

        function deleteUser(userId) {
            if (confirm('Are you sure you want to delete this user?')) {
                let users = JSON.parse(localStorage.getItem('edumentor_admin_users') || '[]');
                users = users.filter(u => u.id != userId);
                localStorage.setItem('edumentor_admin_users', JSON.stringify(users));
                loadUsers();
                showAlert('User deleted successfully!', 'success');
            }
        }

        function viewUser(userId) {
            const users = JSON.parse(localStorage.getItem('edumentor_admin_users') || '[]');
            const user = users.find(u => u.id == userId);
            
            if (user) {
                alert(`User Details:
Name: ${user.firstName} ${user.lastName}
Email: ${user.email}
Role: ${user.role}
Status: ${user.status}
Created: ${user.createdAt}
Last Active: ${user.lastActive || 'N/A'}`);
            }
        }

        function toggleUserStatus(userId) {
            let users = JSON.parse(localStorage.getItem('edumentor_admin_users') || '[]');
            const userIndex = users.findIndex(u => u.id == userId);
            
            if (userIndex !== -1) {
                users[userIndex].status = users[userIndex].status === 'Active' ? 'Inactive' : 'Active';
                users[userIndex].lastModified = new Date().toISOString();
                localStorage.setItem('edumentor_admin_users', JSON.stringify(users));
                loadUsers();
                showAlert(`User status updated to ${users[userIndex].status}!`, 'success');
            }
        }

        // Load and display users
        function loadUsers() {
            const users = JSON.parse(localStorage.getItem('edumentor_admin_users') || '[]');
            const tbody = document.getElementById('usersTableBody');
            
            if (users.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 40px;">
                            <i class="fas fa-users" style="font-size: 48px; color: #ccc; margin-bottom: 16px;"></i>
                            <p>No users found. <a href="#" onclick="openAddUserModal()">Add your first user</a></p>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = users.map(user => `
                <tr data-user-id="${user.id}">
                    <td><input type="checkbox" class="row-checkbox"></td>
                    <td>
                        <div class="user-info">
                            <img src="../assets/images/user-placeholder.jpg" alt="User" class="user-avatar" 
                                 onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iMjAiIGZpbGw9IiNFNUU3RUIiLz4KPHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyIDEyQzE0LjIwOTEgMTIgMTYgMTAuMjA5MSAxNiA4QzE2IDUuNzkwODYgMTQuMjA5MSA0IDEyIDRDOS43OTA4NiA0IDggNS43OTA4NiA4IDhDOCAxMC4yMDkxIDkuNzkwODYgMTIgMTIgMTJaIiBmaWxsPSIjOUNBM0FGIS8+CjxwYXRoIGQ9Ik0xMiAxNEM5LjI2NDcgMTQgNyAxNi4yNjQ3IDcgMTlWMjBIMTdWMTlDMTcgMTYuMjY0NyAxNC43MzUzIDE0IDEyIDE0WiIgZmlsbD0iIzlDQTNBRiIvPgo8L3N2Zz4KPC9zdmc+'">
                            <div>
                                <h4>${user.firstName} ${user.lastName}</h4>
                                <p>${user.email}</p>
                                <span class="user-id">#U${user.id.toString().padStart(6, '0')}</span>
                            </div>
                        </div>
                    </td>
                    <td><span class="role-badge ${user.role.toLowerCase()}">${user.role}</span></td>
                    <td>
                        ${user.role === 'Student' ? 
                            `<div class="course-progress">
                                <span class="course-count">${user.courseCount || 0} courses</span>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${user.progress || 0}%"></div>
                                </div>
                                <span class="progress-text">${user.progress || 0}% avg progress</span>
                            </div>` :
                            user.role === 'Instructor' ?
                            `<div class="instructor-stats">
                                <span class="course-count">${user.coursesTeaching || 0} courses taught</span>
                                <span class="student-count">${user.studentsCount || 0} students</span>
                            </div>` :
                            `<div class="admin-access">
                                <span class="access-level">Full Access</span>
                                <span class="last-login">Last login: ${user.lastActive || 'Never'}</span>
                            </div>`
                        }
                    </td>
                    <td>${user.lastActive || 'Never'}</td>
                    <td>${new Date(user.createdAt).toLocaleDateString()}</td>
                    <td><span class="status-badge ${user.status.toLowerCase()}">${user.status}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-action btn-view" title="View Profile" onclick="viewUser(${user.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-action btn-edit" title="Edit" onclick="openEditUserModal(${user.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-action btn-toggle" title="Toggle Status" onclick="toggleUserStatus(${user.id})">
                                <i class="fas fa-${user.status === 'Active' ? 'pause' : 'play'}"></i>
                            </button>
                            <button class="btn-action btn-delete" title="Delete" onclick="deleteUser(${user.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Handle form submission
        function handleUserSubmit(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const userData = {
                firstName: formData.get('firstName'),
                lastName: formData.get('lastName'),
                email: formData.get('email'),
                role: formData.get('role'),
                status: formData.get('status')
            };

            // Basic validation
            if (!userData.firstName || !userData.lastName || !userData.email) {
                showAlert('Please fill in all required fields!', 'error');
                return;
            }

            let users = JSON.parse(localStorage.getItem('edumentor_admin_users') || '[]');
            const userId = formData.get('userId');

            if (userId) {
                // Update existing user
                const userIndex = users.findIndex(u => u.id == userId);
                if (userIndex !== -1) {
                    users[userIndex] = {
                        ...users[userIndex],
                        ...userData,
                        lastModified: new Date().toISOString()
                    };
                    showAlert('User updated successfully!', 'success');
                }
            } else {
                // Create new user
                const newUser = {
                    id: Date.now(),
                    ...userData,
                    createdAt: new Date().toISOString(),
                    lastModified: new Date().toISOString(),
                    courseCount: 0,
                    progress: 0,
                    coursesTeaching: 0,
                    studentsCount: 0
                };
                users.push(newUser);
                showAlert('User added successfully!', 'success');
            }

            localStorage.setItem('edumentor_admin_users', JSON.stringify(users));
            loadUsers();
            closeAddUserModal();
        }

        // Alert system
        function showAlert(message, type) {
            const alertContainer = document.getElementById('alertContainer') || createAlertContainer();
            
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-triangle'}"></i>
                <span>${message}</span>
                <button onclick="this.parentElement.remove()" style="background: none; border: none; color: inherit; cursor: pointer; float: right;">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            alertContainer.appendChild(alert);
            
            setTimeout(() => {
                if (alert.parentElement) {
                    alert.remove();
                }
            }, 5000);
        }

        function createAlertContainer() {
            const container = document.createElement('div');
            container.id = 'alertContainer';
            container.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 10000;
                max-width: 400px;
            `;
            document.body.appendChild(container);
            return container;
        }

        // Initialize sample data if none exists
        function initializeSampleData() {
            const existingUsers = localStorage.getItem('edumentor_admin_users');
            if (!existingUsers) {
                const sampleUsers = [
                    {
                        id: 1,
                        firstName: 'Sarah',
                        lastName: 'Wilson',
                        email: 'sarah.wilson@email.com',
                        role: 'Student',
                        status: 'Active',
                        createdAt: '2024-01-15T10:30:00Z',
                        lastActive: '2 hours ago',
                        courseCount: 3,
                        progress: 85
                    },
                    {
                        id: 2,
                        firstName: 'Mike',
                        lastName: 'Johnson',
                        email: 'mike.johnson@email.com',
                        role: 'Instructor',
                        status: 'Active',
                        createdAt: '2023-12-08T14:20:00Z',
                        lastActive: '1 day ago',
                        coursesTeaching: 8,
                        studentsCount: 456
                    },
                    {
                        id: 3,
                        firstName: 'Emma',
                        lastName: 'Davis',
                        email: 'emma.davis@email.com',
                        role: 'Student',
                        status: 'Active',
                        createdAt: '2024-02-22T09:15:00Z',
                        lastActive: '3 hours ago',
                        courseCount: 5,
                        progress: 90
                    },
                    {
                        id: 4,
                        firstName: 'Alex',
                        lastName: 'Chen',
                        email: 'alex.chen@email.com',
                        role: 'Admin',
                        status: 'Active',
                        createdAt: '2023-11-03T16:45:00Z',
                        lastActive: '30 minutes ago'
                    }
                ];
                localStorage.setItem('edumentor_admin_users', JSON.stringify(sampleUsers));
            }
        }

        // Initialize Page
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize CRUD system
            initializeSampleData();
            loadUsers();

            // Table selection
            const selectAllCheckbox = document.getElementById('selectAll');
            
            function updateSelectAllState() {
                const rowCheckboxes = document.querySelectorAll('.row-checkbox');
                const checkedBoxes = document.querySelectorAll('.row-checkbox:checked');
                if (selectAllCheckbox) {
                    selectAllCheckbox.checked = rowCheckboxes.length > 0 && checkedBoxes.length === rowCheckboxes.length;
                    selectAllCheckbox.indeterminate = checkedBoxes.length > 0 && checkedBoxes.length < rowCheckboxes.length;
                }
            }

            if (selectAllCheckbox) {
                selectAllCheckbox.addEventListener('change', function() {
                    const rowCheckboxes = document.querySelectorAll('.row-checkbox');
                    rowCheckboxes.forEach(checkbox => {
                        checkbox.checked = this.checked;
                    });
                });
            }

            // Update select all state when rows change
            document.addEventListener('change', function(e) {
                if (e.target.classList.contains('row-checkbox')) {
                    updateSelectAllState();
                }
            });

            // Modal background click
            document.getElementById('addUserModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeAddUserModal();
                }
            });

            // Search functionality
            const searchInput = document.getElementById('globalSearch');
            if (searchInput) {
                searchInput.addEventListener('input', function(e) {
                    const searchTerm = e.target.value.toLowerCase();
                    const users = JSON.parse(localStorage.getItem('edumentor_admin_users') || '[]');
                    const filteredUsers = users.filter(user => 
                        user.firstName.toLowerCase().includes(searchTerm) ||
                        user.lastName.toLowerCase().includes(searchTerm) ||
                        user.email.toLowerCase().includes(searchTerm) ||
                        user.role.toLowerCase().includes(searchTerm)
                    );
                    displayFilteredUsers(filteredUsers);
                });
            }
        });

        function displayFilteredUsers(users) {
            const tbody = document.getElementById('usersTableBody');
            
            if (users.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 40px;">
                            <i class="fas fa-search" style="font-size: 48px; color: #ccc; margin-bottom: 16px;"></i>
                            <p>No users found matching your search.</p>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = users.map(user => `
                <tr data-user-id="${user.id}">
                    <td><input type="checkbox" class="row-checkbox"></td>
                    <td>
                        <div class="user-info">
                            <img src="../assets/images/user-placeholder.jpg" alt="User" class="user-avatar" 
                                 onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iMjAiIGZpbGw9IiNFNUU3RUIiLz4KPHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyIDEyQzE0LjIwOTEgMTIgMTYgMTAuMjA5MSAxNiA4QzE2IDUuNzkwODYgMTQuMjA5MSA0IDEyIDRDOS43OTA4NiA0IDggNS43OTA4NiA4IDhDOCAxMC4yMDkxIDkuNzkwODYgMTIgMTIgMTJaIiBmaWxsPSIjOUNBM0FGIS8+CjxwYXRoIGQ9Ik0xMiAxNEM5LjI2NDcgMTQgNyAxNi4yNjQ3IDcgMTlWMjBIMTdWMTlDMTcgMTYuMjY0NyAxNC43MzUzIDE0IDEyIDE0WiIgZmlsbD0iIzlDQTNBRiIvPgo8L3N2Zz4KPC9zdmc+'">
                            <div>
                                <h4>${user.firstName} ${user.lastName}</h4>
                                <p>${user.email}</p>
                                <span class="user-id">#U${user.id.toString().padStart(6, '0')}</span>
                            </div>
                        </div>
                    </td>
                    <td><span class="role-badge ${user.role.toLowerCase()}">${user.role}</span></td>
                    <td>
                        ${user.role === 'Student' ? 
                            `<div class="course-progress">
                                <span class="course-count">${user.courseCount || 0} courses</span>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${user.progress || 0}%"></div>
                                </div>
                                <span class="progress-text">${user.progress || 0}% avg progress</span>
                            </div>` :
                            user.role === 'Instructor' ?
                            `<div class="instructor-stats">
                                <span class="course-count">${user.coursesTeaching || 0} courses taught</span>
                                <span class="student-count">${user.studentsCount || 0} students</span>
                            </div>` :
                            `<div class="admin-access">
                                <span class="access-level">Full Access</span>
                                <span class="last-login">Last login: ${user.lastActive || 'Never'}</span>
                            </div>`
                        }
                    </td>
                    <td>${user.lastActive || 'Never'}</td>
                    <td>${new Date(user.createdAt).toLocaleDateString()}</td>
                    <td><span class="status-badge ${user.status.toLowerCase()}">${user.status}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-action btn-view" title="View Profile" onclick="viewUser(${user.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-action btn-edit" title="Edit" onclick="openEditUserModal(${user.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-action btn-toggle" title="Toggle Status" onclick="toggleUserStatus(${user.id})">
                                <i class="fas fa-${user.status === 'Active' ? 'pause' : 'play'}"></i>
                            </button>
                            <button class="btn-action btn-delete" title="Delete" onclick="deleteUser(${user.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }
    </script>
</body>
</html>
